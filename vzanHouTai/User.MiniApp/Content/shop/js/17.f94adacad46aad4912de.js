webpackJsonp([17],{Luci:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("Xxa5"),s=a.n(r),n=a("exGp"),i=a.n(n),o=a("1sGI"),c=a.n(o),u=a("Zazt"),l=a("RROI"),d=a("PKHo"),m=a("GKmE"),p=a("xipm"),v=a("lbHh"),f=a.n(v),h={mixins:[d.a],data:function(){return{username:"",password:"",validation:null,domTitle:"登录",wxToken:null,isNewUser:!1,mode:"或通过账号登录"}},components:{error:u.a},methods:{switchMode:function(){this.mode="或通过账号登录"===this.mode?"微信授权登录":"或通过账号登录"},createValidation:function(){return new c.a({username:this.username,password:this.password},{username:"required",password:"required"},{"required.username":"用户名不能为空","required.password":"密码不能为空"})},login:function(e,t){var a=this;return i()(s.a.mark(function r(){var n;return s.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(t){r.next=4;break}if(a.validation=a.createValidation(),a.validation.validate()){r.next=4;break}return r.abrupt("return");case 4:if(m.a.showLoading("登录中"),"master"!=e){r.next=18;break}if(!t){r.next=12;break}return r.next=9,l.a.masterLogin(a.username,a.password,a.wxToken);case 9:r.t1=r.sent,r.next=15;break;case 12:return r.next=14,l.a.masterLogin(a.username,a.password);case 14:r.t1=r.sent;case 15:r.t0=r.t1,r.next=21;break;case 18:return r.next=20,l.a.shopLogin(a.username,a.password);case 20:r.t0=r.sent;case 21:if(!(n=r.t0)){r.next=36;break}if("master"!==e){r.next=31;break}if("string"!=typeof n){r.next=26;break}return r.abrupt("return",m.a.routerReplace(a,"/?isNewUser=1"));case 26:return m.a.setCookie("dz_UserCookieNew",n.loginToken),m.a.setCookie("masterAuth",n.authToken),r.next=30,a.$messagebox.alert("登录成功");case 30:a.$router.replace("accounts");case 31:if("shop"!==e){r.next=36;break}return m.a.setCookie("dzDishAdmin",n.loginToken),r.next=35,a.$messagebox.alert("登录成功");case 35:n.storeId&&a.$router.replace({path:"shop/"+n.storeId+"/home"});case 36:case"end":return r.stop()}},r,a)}))()},handleRedirect:function(){var e=f.a.get("dz_UserCookieNew"),t=f.a.get("masterAuth");e&&t&&m.a.routerReplace(this,"accounts")},wxAuth:function(){var e=this;return i()(s.a.mark(function t(){var a;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.a.wxAuth();case 2:(a=e.sent)&&(window.location.href=a.OAuthUrl);case 4:case"end":return e.stop()}},t,e)}))()}},mounted:function(){p.a.$emit("headerBtn",!1),p.a.$emit("headerLoginOut",!1),this.handleRedirect();var e=this.$route.query;console.log(e),this.wxToken=e.token,this.isNewUser=e.isNewUser,this.wxToken&&this.login("master",!0)}},w={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"admin-login"},[a("div",{staticClass:"form"},[a("h1",{staticClass:"f60 c333"},[e._v("欢迎来到智慧餐厅")]),e._v(" "),a("div",{staticClass:"form-group mt80"},[a("label",{staticClass:"c333 f30",attrs:{for:"user"}},[e._v("用户名")]),a("br"),e._v(" "),a("div",{staticClass:"form-group-input"},[a("mt-field",{attrs:{placeholder:"请输入您的用户名",attr:{id:"user"}},model:{value:e.username,callback:function(t){e.username=t},expression:"username"}}),e._v(" "),a("error",{attrs:{validation:e.validation,check:"username"}})],1)]),e._v(" "),a("div",{staticClass:"form-group mt60"},[a("label",{staticClass:"c333 f30",attrs:{for:"pwd"}},[e._v("密码")]),a("br"),e._v(" "),a("div",{staticClass:"form-group-input"},[a("mt-field",{attrs:{placeholder:"请输入您的密码",type:"password",attr:{id:"pwd"}},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}}),e._v(" "),a("error",{attrs:{validation:e.validation,check:"password"}})],1)])]),e._v(" "),e.isNewUser?a("div",{staticClass:"tc lh14 mt30 f26 c666 theme-color-blue"},[e._v("\n    微信授权的新用户需要使用账号和密码登录一次, "),a("br"),e._v("\n    之后无需进行登录操作\n  ")]):e._e(),e._v(" "),a("div",{staticClass:"btn-box pw30"},[a("div",{staticClass:"mt20"},[a("mt-button",{attrs:{size:"large",type:"primary"},on:{click:function(t){e.login("shop")}}},[e._v("门店管理登陆")])],1),e._v(" "),a("div",{staticClass:"mt20"},[a("mt-button",{attrs:{size:"large",type:"primary"},on:{click:function(t){e.login("master")}}},[e._v("小程序管理登陆")])],1)]),e._v(" "),a("div",{staticClass:"tc lh14 mt30 f26 c666"},[a("span",{staticClass:"theme-color-blue font-under-line",on:{click:e.wxAuth}},[e._v("或微信授权登录")])])])},staticRenderFns:[]};var x=a("VU/8")(h,w,!1,function(e){a("Mtv8")},null,null);t.default=x.exports},Mtv8:function(e,t){}});