webpackJsonp([5],{PwSV:function(t,e){},"dp+b":function(t,e){},"fyo+":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=s("Xxa5"),a=s.n(r),i=s("exGp"),n=s.n(i),o=s("gOJN"),c=s("xSuN"),l=s("/SDt"),u=s("xipm"),d=s("lX04"),f=s("PKHo"),p=s("q0fy"),h=s("MqCY"),m=s("gnfT"),v=s("GKmE"),b={name:"shopOrder",components:{"order-item":o.a,"order-bottom-bar":c.a,"null-data":l.a,bescroll:h.a},mixins:[f.a],methods:{onPullingDown:function(){var t=this;setTimeout(n()(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.resetData().getShopOrderListC();case 2:t.$refs.bescroll.forceUpdate();case 3:case"end":return e.stop()}},e,t)})),1500)},handleChangeTable:function(t){var e=this;return n()(a.a.mark(function s(){return a.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:e.currOrderId=t,e.popupVisible=!0;case 2:case"end":return s.stop()}},s,e)}))()},getTableList:function(){var t=this;return n()(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m.a.getSpecList.call(t,"getTableList","table.list","table.pageIndex","table.pageSize","table.loadAll");case 2:case"end":return e.stop()}},e,t)}))()},onPullingUp:function(){var t=this;return n()(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.loadAll){e.next=3;break}return t.$refs.bescroll.forceUpdate(!1),e.abrupt("return");case 3:return t.pageIndex++,e.next=6,t.getShopOrderListC();case 6:t.$refs.bescroll.forceUpdate(!0);case 7:case"end":return e.stop()}},e,t)}))()},changeTable:function(t){var e=this;return n()(a.a.mark(function s(){return a.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:v.a.msgConfirm("确定要更换桌号？",n()(a.a.mark(function s(){return a.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,p.a.updateOrderInnerStatus("Table",e.currOrderId,t);case 2:if(!s.sent){s.next=7;break}return s.next=6,e.$messagebox.alert("操作成功");case 6:window.location.reload();case 7:case"end":return s.stop()}},s,e)})));case 1:case"end":return s.stop()}},s,e)}))()},goSearch:function(){this.$router.push({path:"order_search?id="+this.StoreId})},openStatus:function(t){if(this.mapStatus)return this.closeMask();this.mapStatus={mapList:t.map,parent:t}},injectStatus:function(t,e){var s=this.mapStatus.mapList,r=this.mapStatus.mapList=this.setDefaultStatus(s);r[e].isSelect=!0,t.inject=r[e].type,this.closeMask()},restoreDefault:function(t){var e=this.mapStatus.mapList;this.mapStatus.mapList=this.setDefaultStatus(e),t.inject="",this.closeMask()},setDefaultStatus:function(t){for(var e=t.length;e--;)t[e].isSelect=!1;return t},closeMask:function(){this.mapStatus=null},getState:function(t){var e=this.statusList[t].map.find(function(t){return!0===t.isSelect});return e&&String(e.id)||""},getShopOrderListC:function(){var t=this;return n()(a.a.mark(function e(){var s;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.a.getShopOrderList(t.StoreId,{orderState:t.orderState,orderType:t.orderType,payState:t.payState,payWay:t.payWay,isToday:t.isToday,pageIndex:t.pageIndex,pageSize:t.pageSize});case 2:(s=e.sent)&&(t.count=s.total,s.page.length>0&&(t.orderList=t.orderList.concat(t.setDefaultStatus(s.page)),s.page.length<t.pageSize?t.loadAll=!0:t.loadAll=!1,t.$store.commit("order/injectOrderList",t.orderList)));case 4:case"end":return e.stop()}},e,t)}))()},resetData:function(){return this.pageSize=10,this.pageIndex=1,this.orderList=[],this.count=0,this}},data:function(){return{table:{list:[],pageIndex:1,pageSize:40,loadAll:!1},popupVisible:!1,pullUpLoad:{threshold:-50,txt:{more:"",noMore:"没有更多了"}},pullDownRefresh:{threshold:90,stop:40},count:0,domTitle:"",mapStatus:null,statusList:[{default:"订单类型",inject:"",map:[{type:"店内",isSelect:!1,id:1},{type:"外卖",isSelect:!1,id:2}]},{default:"订单状态",inject:"",map:[{type:"未确认",isSelect:!1,id:0},{type:"已确认",isSelect:!1,id:1},{type:"已完成",isSelect:!1,id:2},{type:"已取消",isSelect:!1,id:3}]},{default:"支付状态",inject:"",map:[{type:"未付款",isSelect:!1,id:0},{type:"已付款",isSelect:!1,id:1},{type:"已退款",isSelect:!1,id:2}]},{default:"支付方式",map:[{type:"微信支付",isSelect:!1,id:1},{type:"线下支付",isSelect:!1,id:2},{type:"货到付款",isSelect:!1,id:3},{type:"余额支付",isSelect:!1,id:4}]}],orderList:[],pageIndex:1,pageSize:10,StoreId:0,currOrderId:0,loadAll:!1}},computed:{orderType:function(){return this.getState(0)},orderState:function(){return this.getState(1)},payState:function(){return this.getState(2)},payWay:function(){return this.getState(3)},isToday:function(){return"今日订单"==this.domTitle||""},isAllSelect:function(){return this.orderList.length===this.$store.getters["order/getSelectedOrderList"].length}},watch:{statusList:{handler:function(){this.resetData().getShopOrderListC()},deep:!0}},created:function(){var t=this.$route.query;this.domTitle=t.domTitle,this.StoreId=t.id,this.$cache("StoreId",this.StoreId)},mounted:function(){u.a.$on("click-order-bottom-bar",d.a.bind(this)),this.getShopOrderListC(),this.getTableList()},beforeDestroy:function(){u.a.$off("click-order-bottom-bar"),this.$store.commit("order/resetOrderList")}},S={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"shop-order"},[s("div",{staticClass:"fixed w-full pt24 z10 bg-f5 top0"},[s("div",{staticClass:"mock-search f fc",on:{click:t.goSearch}},[s("i",{staticClass:"dzicon cC5C4CC icon-icon_sousuo f40"}),t._v(" "),s("span",{staticClass:"cC5C4CC f26 ml10"},[t._v("请输入订单号")])]),t._v(" "),s("div",{staticClass:"order-status-bar bg-w mt20 f border-bottom"},t._l(t.statusList,function(e,r){return s("div",{staticClass:"status f jc fc c666",on:{click:function(s){t.openStatus(e)}}},[s("span",{staticClass:"fs",class:e.inject?"theme-color":""},[t._v(t._s(e.inject||e.default))]),s("i",{staticClass:"dzicon icon-icon_xiala f26",class:e.inject?"theme-color":"cC5C4CC"})])}))]),t._v(" "),s("transition",{attrs:{name:"fade-in"}},[t.mapStatus?s("div",{staticClass:"map-status fixed c666"},[t._l(t.mapStatus.mapList,function(e,r){return s("div",{staticClass:"status-item f fc rel",class:e.isSelect?"theme-color":"",on:{click:function(e){t.injectStatus(t.mapStatus.parent,r)}}},[t._v("\n        "+t._s(e.type)+"\n        "),e.isSelect?s("i",{staticClass:"dzicon icon-icon_xuanze f30 abs theme-color"}):t._e()])}),t._v(" "),s("div",{staticClass:"status-item f fc rel",class:t.mapStatus.parent.inject?"":"theme-color",on:{click:function(e){t.restoreDefault(t.mapStatus.parent)}}},[t._v("\n        默认\n        "),t.mapStatus.parent.inject?t._e():s("i",{staticClass:"dzicon icon-icon_xuanze f30 abs theme-color"})])],2):t._e()]),t._v(" "),s("bescroll",{ref:"bescroll",attrs:{pullDownRefresh:t.pullDownRefresh,data:t.orderList,listenScrollEnd:!0,pullUpLoad:t.pullUpLoad,wrapperClass:"top:35vw;"},on:{pullingDown:t.onPullingDown,pullingUp:t.onPullingUp}},[s("div",{staticClass:"mt188 pb40"},t._l(t.orderList,function(e,r){return s("order-item",{key:r,attrs:{index:r,orderInfo:e},on:{changeTable:t.handleChangeTable}})}))]),t._v(" "),s("order-bottom-bar",{attrs:{isSelect:t.isAllSelect,show:!!t.orderList.length}}),t._v(" "),s("null-data",{attrs:{show:!t.orderList.length}}),t._v(" "),s("mt-popup",{model:{value:t.popupVisible,callback:function(e){t.popupVisible=e},expression:"popupVisible"}},[s("div",{staticClass:"printer-wrapper pt20"},[s("div",{staticClass:"title lh14 f40 t-b pb20 tc c333 border-bottom"},[t._v("餐桌列表")]),t._v(" "),s("div",{staticClass:"list"},t._l(t.table.list,function(e,r){return s("div",{staticClass:"item f fc c666 f26",on:{click:function(s){t.changeTable(e.Id)}}},[t._v("\n          编号："+t._s(r+1)+" "),s("span",{staticClass:"ml20"},[t._v("名字："+t._s(e.Name))])])}))])])],1)},staticRenderFns:[]};var _=s("VU/8")(b,S,!1,function(t){s("PwSV")},null,null);e.default=_.exports},gOJN:function(t,e,s){"use strict";var r=s("Xxa5"),a=s.n(r),i=s("exGp"),n=s.n(i),o=(s("q0fy"),{name:"orderItem",props:{orderInfo:{type:Object,default:null},index:Number},data:function(){return{}},computed:{isTakeOut:function(){return this.orderInfo&&"外卖"===this.orderInfo.OrderType}},methods:{select:function(){this.$store.commit("order/selectOrder",this.index)},switchDeskModal:function(){var t=this;return n()(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.$emit("changeTable",t.orderInfo.Id);case 1:case"end":return e.stop()}},e,t)}))()},goDetail:function(){this.$router.push({path:"order_detail?id="+this.orderInfo.Id})},noop:function(){}}}),c={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.orderInfo?s("div",{staticClass:"order-item mb20",on:{click:t.goDetail}},[s("div",{staticClass:"f fj mb30"},[s("div",{staticClass:"order-num f fc c333 f30"},[s("i",{staticClass:"dzicon mr20 f40",class:t.orderInfo.isSelect?"theme-color-red icon-icon_yixuan":"cccc icon-icon_weixuan",on:{click:function(e){return e.stopPropagation(),t.select(e)}}}),t._v(" "),s("span",[t._v(t._s(t.orderInfo.OrderNo))])]),t._v(" "),s("span",{staticClass:"theme-color-red f fc"},[t._v(t._s(t.orderInfo.OrderState))])]),t._v(" "),s("div",{staticClass:"detail f28"},[s("div",{staticClass:"group mb20"},[s("span",{staticClass:"c666 mr20 title"},[t._v("下单时间:")]),s("span",{staticClass:"c333"},[t._v(t._s(t.orderInfo.OrderDate))])]),t._v(" "),s("div",{staticClass:"group mb20"},[s("span",{staticClass:"c666 mr20 title"},[t._v("用户名:")]),s("span",{staticClass:"c333 mr10"},[t._v(t._s(t.orderInfo.ReceivingName||t.orderInfo.PickUpName||t.orderInfo.UserName))]),t._v(" "),s("mt-badge",{attrs:{size:"small"}},[t._v(t._s(t.orderInfo.OrderType))])],1),t._v(" "),s("div",{staticClass:"group mb20",on:{click:function(e){return e.stopPropagation(),t.noop(e)}}},[s("span",{staticClass:"c666 mr20 title"},[t._v("订单金额:")]),s("span",{staticClass:"c333 mr10"},[t._v("￥"+t._s(t.orderInfo.PayAmount))])]),t._v(" "),t.isTakeOut?[s("div",{staticClass:"group mb20 f"},[s("span",{staticClass:"c666 mr20 fs title"},[t._v("收货地址:")]),t._v(" "),s("div",{staticClass:"c333 mr10 w500 ellipsis"},[t._v(t._s(t.orderInfo.Address))])]),t._v(" "),s("div",{staticClass:"group mb20"},[s("span",{staticClass:"c666 mr20 title"},[t._v("手机号:")]),s("span",{staticClass:"c333 mr10"},[t._v(t._s(t.orderInfo.ReceivingPhoneNo||t.orderInfo.PickUpPhoneNo))])])]:t._e(),t._v(" "),t.isTakeOut?t._e():[t.orderInfo.Table?s("div",{staticClass:"group mb20",on:{click:function(e){return e.stopPropagation(),t.switchDeskModal(e)}}},[s("span",{staticClass:"c666 mr20 title"},[t._v("桌号:")]),s("span",{staticClass:"c333 mr10"},[t._v("双人桌"+t._s("-"+t.orderInfo.Table)+" "),s("i",{staticClass:"f30 dzicon icon-icon_genghuan theme-color-blue"})])]):t._e()]],2)]):t._e()},staticRenderFns:[]};var l=s("VU/8")(o,c,!1,function(t){s("dp+b")},null,null);e.a=l.exports},iEQH:function(t,e){},lX04:function(t,e,s){"use strict";var r=s("Xxa5"),a=s.n(r),i=s("exGp"),n=s.n(i),o=s("q0fy"),c=s("GKmE");e.a=function(t){var e,s=(e=n()(a.a.mark(function t(e){var s;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a=void 0,a=r.$store.getters["order/getSelectedOrderList"],!i(s=a.reduce(function(t,e,s,r){return t+=r.length-1===s?e.Id:e.Id+","},""))){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,o.a.updateOrderStatus(s,e);case 5:if(!t.sent){t.next=10;break}return t.next=9,r.$messagebox.alert("更新成功");case 9:r.resetData().getShopOrderListC();case 10:case"end":return t.stop()}var a},t,this)})),function(t){return e.apply(this,arguments)}),r=this;switch(t){case"全选":r.$store.commit("order/setOrderSelectStatus");break;case"清空":r.$store.commit("order/setOrderSelectStatus","default");break;case"确认":s("confirm");break;case"付款":s("pay");break;case"完成":s("complete");break;case"取消":s("cancel");break;case"删除":s("delete")}function i(t){if(!t)return c.a.toast("您还没选择订单"),!0}}},xSuN:function(t,e,s){"use strict";var r=s("xipm"),a={name:"orderBottomBar",props:{show:Boolean,isSelect:Boolean},data:function(){return{showMoreSettings:!1,selectAll:this.isSelect}},watch:{isSelect:function(t){this.selectAll=t}},methods:{switchSelect:function(){this.selectAll=!this.selectAll;var t=this.selectAll?"全选":"清空";this.onClickAfter(t)},showMore:function(){this.showMoreSettings=!this.showMoreSettings},onClickAfter:function(t){"全选"!=t&&"清空"!=t?this.$messagebox.confirm("确认要更新订单状态吗？").then(function(e){"confirm"===e&&r.a.$emit("click-order-bottom-bar",t)},function(t){}):r.a.$emit("click-order-bottom-bar",t),this.showMoreSettings=!1}}},i={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.show?s("div",{staticClass:"order-bottom-bar c333 f fj fc fixed bg-w z10"},[s("div",{staticClass:"btn-select-all f fc f30"},[s("i",{staticClass:"dzicon f40 mr20",class:t.selectAll?"theme-color-red icon-icon_yixuan":"icon-icon_weixuan cccc",on:{click:t.switchSelect}}),s("span",[t._v("全选")])]),t._v(" "),s("div",{staticClass:"action-list f fc f26"},[s("span",{staticClass:"mr24 rel"},[s("span",{on:{click:t.showMore}},[t._v("更多")]),t._v(" "),s("transition",{attrs:{name:"fade-in"}},[t.showMoreSettings?s("div",{staticClass:"settings abs cfff f arrow_bottom"},[s("div",{staticClass:"f fc f26 settings-item rel",on:{click:function(e){t.onClickAfter("取消")}}},[s("div",{staticClass:"fs"},[t._v("取消")]),t._v(" "),s("div",{staticClass:"line abs"})]),t._v(" "),s("div",{staticClass:"f fc f26 settings-item rel",on:{click:function(e){t.onClickAfter("删除")}}},[s("div",{staticClass:"fs"},[t._v("删除")])])]):t._e()])],1),t._v(" "),s("div",{staticClass:"btn-base mr24 theme-color-blue border-blue tc",on:{click:function(e){t.onClickAfter("确认")}}},[t._v("\n      确认\n    ")]),t._v(" "),s("div",{staticClass:"btn-base mr24 theme-color-light-red  border-light-red tc",on:{click:function(e){t.onClickAfter("付款")}}},[t._v("\n      付款\n    ")]),t._v(" "),s("div",{staticClass:"btn-base mr24 theme-color-orange  border-orange tc",on:{click:function(e){t.onClickAfter("完成")}}},[t._v("\n      完成\n    ")])])]):t._e()},staticRenderFns:[]};var n=s("VU/8")(a,i,!1,function(t){s("iEQH")},null,null);e.a=n.exports}});