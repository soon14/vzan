webpackJsonp([34],{U7rG:function(t,e){},fzcs:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n("Xxa5"),s=n.n(r),a=n("exGp"),i=n.n(a),c=n("0+fh"),o=n("q0fy"),l=n("z5is"),u=n("GKmE"),p=n("gnfT"),f={props:{open:Boolean,attrs:Array},mixins:[l.a],data:function(){return{attrType:{list:[],selectValue:{v:"",id:""},defaultValue:"请选择",ass:{pageIndex:1,pageSize:20,loadAll:!1}},StoreId:0,attr:{all:{},inject:[]},isNeedRestore:!1,sattr:[]}},components:{selector:c.a},watch:{"attrType.selectValue.id":{handler:function(t){var e=this;return i()(s.a.mark(function n(){var r;return s.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:(r=e.attr).inject=t?r.all[t]:[];case 2:case"end":return n.stop()}},n,e)}))()},deep:!0},open:function(t){t&&this.post()},attrs:function(t){console.log(t,"attrs"),this.restoreFormServer(t)}},methods:{specTips:function(t){return t.Item.length?t.Option||"规格属性":"未设规格"},handleSelect:function(t,e){this.attrType.selectValue.v=t,this.attrType.selectValue.id=e},switcher:function(){this.$refs.selector.open()},getProductAttrbuteType:function(){var t=this;return i()(s.a.mark(function e(){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.a.getSpecList.call(t,"getProductAttrbuteType","attrType.list","attrType.ass.pageIndex","attrType.ass.pageSize","attrType.ass.loadAll");case 2:case"end":return e.stop()}},e,t)}))()},getProductAttrbuteGroup:function(t){var e=this;return i()(s.a.mark(function n(){var r;return s.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,o.a.getProductAttrbuteGroup(t);case 2:(r=n.sent)&&(e.attr.all[t]=e.initAttrList(r.page));case 4:case"end":return n.stop()}},n,e)}))()},openMask:function(t){var e=this.attr.inject[t];e.isOpenSelector||this.setDefaultOpen(this.attr.inject),this.attr.inject[t].isOpenSelector=!e.isOpenSelector},setDefaultOpen:function(t){for(var e,n=0;e=t[n++];)e.isOpenSelector=!1;return t},initAttrList:function(t){var e=this;return t.forEach(function(t){t.isOpenSelector=!1,t.AttrId=t.Id,t.Option="",t.Item=e.setDisable(t.Item),delete t.Id,t.hasOwnProperty("Price")||(t.Price="0")}),t},setDisable:function(t){return t.map(function(t){return{value:t,disable:!1}})},removeAttr:function(t){this.attr.inject.splice(t,1)},addSpec:function(t,e){var n=u.a.cloneDeep(t);n.Item=t.Item,n.Option="",n.Id=0,this.attr.inject.splice(e+1,0,n)},chooseSpec:function(t,e,n,r){e.Item;this.$set(e,"Option",n.value),this.$set(this.attr.inject,t,e),this.setDefaultOpen(this.attr.inject)},activeSpecOptionDisable:function(t,e){var n=this;t.forEach(function(t,r){e==r&&n.$set(t,"disable",!0)})},shrink:function(t){for(var e,n=["Sort","isOpenSelector","Type","Name","Item"],r=0;e=n[r++];)delete t[e];return t},restoreFormServer:function(t){var e=this;return i()(s.a.mark(function n(){var r,a,i;return s.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!t.length){n.next=13;break}return n.next=3,e.getProductAttrbuteType();case 3:return n.next=5,e.getAllAttr();case 5:r={},console.log(e.attr.all,"完成2"),t.forEach(function(t,n){var s=t.AttrTypeId,a=t.AttrId;e.attr.all[s].forEach(function(t){if(a==t.AttrId){var e=s+"."+t.AttrId;r[e]=t}})}),console.log(r,"模型对象"),a=0,t.forEach(function(t,n){var s=t.AttrTypeId,i=t.AttrId,c=s+"."+i;console.log(r[c],"cloneDeepbefore");var o=u.a.cloneDeep(r[c]);o.Id=t.Id,o.Price=t.Price,o.Option=t.Option,o.Option&&(a=s);var l=0;e.attr.all[t.AttrTypeId].find(function(t,e){if(t.AttrId==i)return l=e,!0}),e.attr.all[t.AttrTypeId].splice(l,1,o)}),i=e.attrType.list.find(function(t){return t.Id==a}),e.$refs.selector.injectStatus(i);case 13:case"end":return n.stop()}},n,e)}))()},getAllAttr:function(){var t=this;return i()(s.a.mark(function e(){var n,r,a;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=0,a=t.attrType.list;case 2:if(!(r=a[n++])){e.next=7;break}return e.next=5,t.getProductAttrbuteGroup(r.Id);case 5:e.next=2;break;case 7:console.log("完成");case 8:case"end":return e.stop()}},e,t)}))()},post:function(){for(var t=this,e=this.concatAttslist(),n=(e=e.slice().map(function(e){return e=u.a.cloneDeep(e),t.shrink(e)})).length;n--;){var r=e[n];e.forEach(function(t,e,s){e!=n&&r.Option==t.Option&&r.AttrId==t.AttrId&&s.splice(e,1)})}this.$emit("finished",e)},concatAttslist:function(){var t=[],e=this.attr.all;for(var n in e){var r=e[n];r.length>0&&(t=t.concat(r))}return t}},mounted:function(){var t=this;return i()(s.a.mark(function e(){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("create"!==t.$route.query.mode){e.next=4;break}return e.next=3,t.getProductAttrbuteType();case 3:t.getAllAttr();case 4:case"end":return e.stop()}},e,t)}))()}},d={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"products-edit-property c333 f30"},[n("div",{staticClass:"item f fc fj pw24 w-full bg-w border-bottom",attrs:{id:"classify"},on:{click:t.switcher}},[n("span",[t._v("商品类型")]),t._v(" "),n("span",{class:t.attrType.selectValue.v?"theme-color":"c333"},[t._v(t._s(t.attrType.selectValue.v||t.attrType.defaultValue)+" "),n("i",{staticClass:"dzicon icon-icon_xiala1"})])]),t._v(" "),n("div",{staticClass:"list f28"},t._l(t.attr.inject,function(e,r){return n("div",{staticClass:"item f fc pw24 mb20 w-full bg-w c666 rel"},[n("i",{staticClass:"dzicon icon-icon_tianjia1 theme-color-red f40 abs",on:{click:function(n){t.addSpec(e,r)}}}),t._v(" "),n("div",{staticClass:"name fs tc theme-color-green ellipsis ml25 mr20"},[t._v("\n        "+t._s(e.Name)+"\n      ")]),t._v(" "),n("div",{staticClass:"f rel",class:"未设规格"===t.specTips(e)?"cccc":"",on:{click:function(e){t.openMask(r)}}},[n("span",{staticClass:"display-inline-block type ellipsis fs"},[t._v(t._s(t.specTips(e)))]),t._v(" "),n("i",{staticClass:"dzicon icon-icon_xiala1"}),t._v(" "),e.isOpenSelector&&e.Item.length>0?n("ul",{staticClass:"select-list abs c999 z10"},[t._l(e.Item,function(s,a){return s.disable?t._e():n("li",{staticClass:" ellipsis tc",on:{click:function(n){n.stopPropagation(),t.chooseSpec(r,e,s,a)}}},[t._v("\n            "+t._s(s.value)+"\n          ")])}),t._v(" "),n("li",{staticClass:" ellipsis tc",on:{click:function(n){n.stopPropagation(),t.chooseSpec(r,e,{value:""})}}},[t._v("\n            规格属性\n          ")])],2):t._e()]),t._v(" "),n("div",{staticClass:"title fs ml20"},[t._v("\n        价格:\n      ")]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.Price,expression:"item.Price"}],staticClass:"ml20 input tc",attrs:{type:"text",placeholder:"请输入"},domProps:{value:e.Price},on:{input:function(n){n.target.composing||t.$set(e,"Price",n.target.value)}}}),t._v(" "),n("div",{staticClass:"unit fs ml10 mr10"},[t._v("\n        元\n      ")]),t._v(" "),n("div",{staticClass:"btn-null btn-null-gray f fc jc fs ml20",on:{click:function(e){t.removeAttr(r)}}},[t._v("删除")])])})),t._v(" "),n("p",{staticClass:"theme-color-blue f22 lh14 mb20 pw24 mt20"},[t._v("\n    如果有重复属性，将只保存第一个\n  ")]),t._v(" "),t._m(0),t._v(" "),n("selector",{ref:"selector",attrs:{list:t.attrType.list,"el-id":"classify"},on:{selected:t.handleSelect}})],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("p",{staticClass:"theme-color-blue f22 lh14 mb20 pw24"},[this._v("\n    注意：多规格产品价格=规格1价格+规格2价格+规格3价格..."),e("br"),this._v("\n    选多个规格时，价格是累加的\n  ")])}]};var v=n("VU/8")(f,d,!1,function(t){n("U7rG")},null,null);e.default=v.exports}});