
@{
    ViewBag.Title = "PaySetting";
    Layout = "~/Areas/DishAdmin/Views/Shared/_LayoutDishAdmin.cshtml";
}
@model DishStore
<nav class="breadcrumb">
    <i class="Hui-iconfont">&#xe67f;</i> 首页
    <span class="c-gray en">&gt;</span>
    系统管理
    <span class="c-gray en">&gt;</span>
    支付配置
    <a class="btn btn-success radius r" style="line-height:1.6em;margin-top:3px" href="javascript:location.replace(location.href);" title="刷新"><i class="Hui-iconfont">&#xe68f;</i></a>
</nav>
<div class="page-container">
    <form class="form form-horizontal" id="form-article-add" method="post">
        <input type="hidden" name="aid" value="@Model.aid" />
        <input type="hidden" name="storeId" value="@Model.id" />
        <input type="hidden" name="act" value="save" />
        <div id="tab-system" class="HuiTab">
            <div class="tabBar cl">
                <span>基本设置</span>
            </div>
            <div class="tabCon">
                <!--<div class="row cl">
        <label class="form-label col-xs-4 col-sm-2">
            支付模式：</label>
        <div class="formControls col-xs-8 col-sm-9 skin-minimal">
            <div class="radio-box">
                <input name="pay_payment_type" value="1" type="radio" checked />
                <label for="pay_payment_type-1">代理支付</label>
            </div>
        </div>
    </div>-->
                <div class="row cl">
                    <label class="form-label col-xs-4 col-sm-2">
                        微信支付：
                    </label>
                    <div class="formControls col-xs-8 col-sm-9 skin-minimal">
                        <div class="radio-box">
                            <input name="pay_weixin_isopen" value="1" type="radio" @(Model.paySetting.pay_weixin_isopen == 1 ? "checked" : "")>
                            <label for="pay_weixin_isopen-1">开启</label>
                        </div>
                        <div class="radio-box">
                            <input type="radio" value="0" name="pay_weixin_isopen" @(Model.paySetting.pay_weixin_isopen == 0 ? "checked" : "")>
                            <label for="pay_weixin_isopen-2">关闭</label>
                        </div>
                    </div>
                </div>

                <div class="row cl">
                    <label class="form-label col-xs-4 col-sm-2">
                        现金支付：
                    </label>
                    <div class="formControls col-xs-8 col-sm-9 skin-minimal">
                        <div class="radio-box">
                            <input name="pay_xianjin_isopen" value="1" type="radio" @(Model.paySetting.pay_xianjin_isopen == 1 ? "checked" : "")>
                            <label for="pay_xianjin_isopen-1">开启</label>
                        </div>
                        <div class="radio-box">
                            <input type="radio" value="0" name="pay_xianjin_isopen" @(Model.paySetting.pay_xianjin_isopen == 0 ? "checked" : "")>
                            <label for="pay_xianjin_isopen-2">关闭</label>
                        </div>
                    </div>
                </div>

                <div class="row cl">
                    <label class="form-label col-xs-4 col-sm-2">
                        货到支付：
                    </label>
                    <div class="formControls col-xs-8 col-sm-9 skin-minimal">
                        <div class="radio-box">
                            <input name="pay_daofu_isopen" value="1" type="radio" @(Model.paySetting.pay_daofu_isopen == 1 ? "checked" : "")>
                            <label for="dish_open_status-1">开启</label>
                        </div>
                        <div class="radio-box">
                            <input type="radio" value="0" name="pay_daofu_isopen" @(Model.paySetting.pay_daofu_isopen == 0 ? "checked" : "")>
                            <label for="dish_open_status-2">关闭</label>
                        </div>
                    </div>
                </div>

                <div class="row cl">
                    <label class="form-label col-xs-4 col-sm-2">
                        余额支付：
                    </label>
                    <div class="formControls col-xs-8 col-sm-9 skin-minimal">
                        <div class="radio-box">
                            <input name="pay_yuer_isopen" value="1" type="radio" @(Model.paySetting.pay_yuer_isopen == 1 ? "checked" : "")>
                            <label for="pay_yuer_isopen-1">开启</label>
                        </div>
                        <div class="radio-box">
                            <input type="radio" value="0" name="pay_yuer_isopen" @(Model.paySetting.pay_yuer_isopen == 0 ? "checked" : "")>
                            <label for="pay_yuer_isopen-2">关闭</label>
                        </div>
                        <div class="dish_m_tips">开启余额支付前请先开启会员卡功能</div>
                    </div>
                </div>

                <div class="row cl">
                    <label class="form-label col-xs-4 col-sm-2">
                        门店买单使用优惠券：
                    </label>
                    <div class="formControls col-xs-8 col-sm-9 skin-minimal">
                        <div class="radio-box">
                            <input name="pay_is_useCoupon" value="1" type="radio" @(Model.paySetting.pay_is_useCoupon == 1 ? "checked" : "")>
                            <label for="pay_is_useCoupon-1">开启</label>
                        </div>
                        <div class="radio-box">
                            <input type="radio" value="0" name="pay_is_useCoupon" @(Model.paySetting.pay_is_useCoupon == 0 ? "checked" : "")>
                            <label for="pay_is_useCoupon-2">关闭</label>
                        </div>
                    </div>
                </div>
            </div>
            <!--<div class="tabCon">
            <div class="row cl">
                <label class="form-label col-xs-4 col-sm-2">
                    AppID：</label>
                <div class="formControls col-xs-8 col-sm-9">
                    <input type="text" name="pay_appid" placeholder="" value="" class="input-text">
                    <div class="dish_m_tips">小程序appid</div>
                </div>
            </div>
            <div class="row cl">
                <label class="form-label col-xs-4 col-sm-2">
                    AppSecret：</label>
                <div class="formControls col-xs-8 col-sm-9">
                    <input type="text" name="pay_appsecret" placeholder="" value="" class="input-text">
                    <div class="dish_m_tips">小程序应用密钥</div>
                </div>
            </div>
            <div class="row cl">
                <label class="form-label col-xs-4 col-sm-2">
                    支付密钥：</label>
                <div class="formControls col-xs-8 col-sm-9">
                    <input type="text" name="pay_partnerKey" placeholder="" value="" class="input-text">
                    <div class="dish_m_tips">PartnerKey</div>
                </div>
            </div>
            <div class="row cl">
                <label class="form-label col-xs-4 col-sm-2">
                    微信支付商户号：</label>
                <div class="formControls col-xs-8 col-sm-9">
                    <input type="text" name="pay_shanghuhao" placeholder="" value="" class="input-text">
                </div>
            </div>
            <div class="row cl">
                <label class="form-label col-xs-4 col-sm-2">
                    上传证书(apiclient_cert.pem)：</label>
                <div class="formControls col-xs-8 col-sm-9">
                    <div class="controls upload_file">
                        <input type="file" id="upload_file_pay_cert_pem">
                        <input type="hidden" name="pay_cert_pem" value="0"/>
                        <div class="upload-img-box">
                                                        </div>
                    </div>
                    <script type="text/javascript">
                        //上传图片
                        /* 初始化上传插件 */
                        $("#upload_file_pay_cert_pem").uploadify({
                            "height"          : 30,
                            "swf"             : "/Public/static/uploadify/uploadify.swf",
                            "fileObjName"     : "download",
                            "buttonText"      : "上传附件",
                            "uploader"        : "http://wx.ixiaochengxu.cc/index.php?s=/home/file/upload/session_id/mh8fnv0trgi1maklek6j5tono4.html",
                            "width"           : 120,
                            'removeTimeout'	  : 1,
                            "onUploadSuccess" : uploadFilepay_cert_pem
                        });
                        function uploadFilepay_cert_pem(file, data){
                            var data = $.parseJSON(data);
                            if(data.status){
                                var name = "pay_cert_pem";
                                $("input[name="+name+"]").val(data.id);
                                $("input[name="+name+"]").parent().find('.upload-img-box').html(
                                        "<div class=\"upload-pre-file\"><span class=\"upload_icon_all\"></span>" + data.name + "</div>"
                                );
                            } else {
                                updateAlert(data.info);
                                setTimeout(function(){
                                    $('#top-alert').find('button').click();
                                    $(this).removeClass('disabled').prop('disabled',false);
                                },1500);
                            }
                        }
                    </script>
                </div>
            </div>
            <div class="row cl">
                <label class="form-label col-xs-4 col-sm-2">
                    上传证书(apiclient_key.pem)：</label>
                <div class="formControls col-xs-8 col-sm-9">
                    <div class="controls upload_file">
                        <input type="file" id="upload_file_pay_key_pem">
                        <input type="hidden" name="pay_key_pem" value="0"/>
                        <div class="upload-img-box">
                                                        </div>
                    </div>
                    <script type="text/javascript">
                        //上传图片
                        /* 初始化上传插件 */
                        $("#upload_file_pay_key_pem").uploadify({
                            "height"          : 30,
                            "swf"             : "/Public/static/uploadify/uploadify.swf",
                            "fileObjName"     : "download",
                            "buttonText"      : "上传附件",
                            "uploader"        : "http://wx.ixiaochengxu.cc/index.php?s=/home/file/upload/session_id/mh8fnv0trgi1maklek6j5tono4.html",
                            "width"           : 120,
                            'removeTimeout'	  : 1,
                            "onUploadSuccess" : uploadFilepay_key_pem
                        });
                        function uploadFilepay_key_pem(file, data){
                            var data = $.parseJSON(data);
                            if(data.status){
                                var name = "pay_key_pem";
                                $("input[name="+name+"]").val(data.id);
                                $("input[name="+name+"]").parent().find('.upload-img-box').html(
                                        "<div class=\"upload-pre-file\"><span class=\"upload_icon_all\"></span>" + data.name + "</div>"
                                );
                            } else {
                                updateAlert(data.info);
                                setTimeout(function(){
                                    $('#top-alert').find('button').click();
                                    $(this).removeClass('disabled').prop('disabled',false);
                                },1500);
                            }
                        }
                    </script>
                </div>
            </div>
        </div>-->
        </div>
        <div class="row cl">
            <div class="col-xs-8 col-sm-9 col-xs-offset-4 col-sm-offset-2">
                <button class="btn btn-primary radius" type="submit" id="submit_button"><i class="Hui-iconfont">&#xe632;</i> 保存</button>
                <button class="btn btn-default radius" type="button">&nbsp;&nbsp;取消&nbsp;&nbsp;</button>
            </div>
        </div>
    </form>
</div>

@section scripts{
    <!--请在下方写此页面业务相关的脚本-->
    <script type="text/javascript">
        $(function () {
            $('.skin-minimal input').iCheck({
                checkboxClass: 'icheckbox-blue',
                radioClass: 'iradio-blue',
                increaseArea: '20%'
            });
           
            $("#tab-system").Huitab("#tab-system .tabBar span", "#tab-system .tabCon", "current", "click", "0")

            //表单验证
            $("#form-article-add").validate({
                rules: {
                    dish_name: {
                        required: true,
                        minlength: 2
                    },
                    dish_yingye_btime: {
                        required: true,
                        min: 0,
                        max: 24
                    },
                    dish_yingye_etime: {
                        required: true,
                        min: 0,
                        max: 24
                    },
                    dish_con_mobile: {
                        required: true,
                        isMobile: true
                    }
                },
                onkeyup: false,
                focusCleanup: true,
                success: "valid",
                submitHandler: function (form) {   //表单提交句柄,为一回调函数，带一个参数：form
                    var l_index = layer.msg('数据更新中', {
                        icon: 16,
                        shade: 0.5
                    });
                    $("#submit_button").attr("disabled", true);
                    $(form).ajaxSubmit({
                        dataType: "json",
                        success: function (data) {
                            $("#submit_button").attr("disabled", false);
                            layer.close(l_index);
                            if (data.code == 0) {
                                layer.alert(data.msg, { icon: 0 });
                            } else {
                                layer.alert(data.msg, { icon: 1 }, function (index) {
                                    window.location.reload();
                                });
                            }
                        }
                    });
                }
            });

        });
    </script>
    <!--/请在上方写此页面业务相关的脚本-->
}
