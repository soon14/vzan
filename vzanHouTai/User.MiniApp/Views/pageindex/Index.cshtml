@using Entity.MiniApp.Conf
@{
    ViewBag.Title = "自定义页面";
    ViewBag.PageType = 4;//1是行业版同城，用于母版页的左侧菜单区分
    Layout = "~/Views/Shared/_MiniappLayout.cshtml";
    PageIndexControl pageIndexModel = ViewBag.PageIndex as PageIndexControl;
    if (pageIndexModel == null)
    {
        pageIndexModel = new PageIndexControl();
    }

}
<link href="@(WebSiteConfig.cdnurl)content/Miniapp/css/iconfont.css" rel="stylesheet" />
<link href="@(WebSiteConfig.cdnurl)content/Miniapp/css/jquery.dad.css" rel="stylesheet" />
<style>
    body { min-width: 1024px !important; }
    .ImgItem img { width: 100%; }
    /*.editorItem img{width:100%;}*/
    .right { padding-right: 0px !important; }

    .flex-v { -webkit-box-orient: vertical; -webkit-box-direction: vertical; -ms-flex-direction: column; flex-direction: column; -webkit-flex-direction: column; }
    .d-flex { display: -webkit-box; display: -webkit-flex; display: -ms-flexbox; display: flex; }
    /*.flex { -webkit-box-flex: 1; -webkit-flex: 1; -ms-flex: 1; flex: 1; }*/
    .d-flex-center { align-items: center; -webkit-box-align: center; -webkit-align-items: center; -ms-flex-align: center; }
    .cur { border: dashed 2px red }

    .menuItem { width: 35%; border-radius: 5px; border: 1px solid #d1d1d1; height: 100px; margin: 10px; line-height: 100px; text-align: center; }
    a { text-decoration: none; }
    #txtBody { background-color: #f5f5f9 }
    .item { border: solid 2px #faf4f4; }
    /*.bannerItem { min-height: 150px; }*/
    .bannerItem img { height: 100%; width: 100%; }

    .videoItem { height: 150px; }
        .videoItem img { height: 100%; margin-left: 30%; }
    #header span:hover { border: dashed 2px red }
    .item:hover { border: dashed 2px red }
        .item:hover .actionItem { display: inline-block; }
    .footerAction { margin-top: -17px; text-align: right; }
    .zw { width: 60%; display: inline-block; }
    .actionItem { display: none; cursor: pointer; margin-left: 5px; word-break: keep-all; background-color: rgba(0,0,0,0.3); color: #fff; padding: 0 5px; margin-left: 1px; font-size: 12px; }
    /*.actionItem:hover { background-color: rgba(204, 204, 204, 0.72); }*/
    .banner img { height: 100%; }
    .ItemContent { height: 100%; }
    .editorItem { width: 100%; background-color: white; min-height: 300px; }
    .formItem { background-color: #f5f5f9 }
    .formTitle { text-align: center; }
    .form-control { margin-left: 1rem; width: 95%; }
    .formInput { height: 40px; margin-bottom: 1rem; }
    .formInputItem { border: none; width: 1%; margin-left: 1rem; height: 100%; }
    .CheckBoxGroups li { width: 95%; margin-left: 10px; height: 40px; line-height: 40px; background-color: white; margin-top: 5px; }
    .CheckBoxGroupsItem { margin-left: 15px; }
    .CheckBoxGroups img { height: 25px; float: right; margin-top: 10px; margin-right: 10px; }
    .phoneTitle { height: 50px; text-align: center; }
        .phoneTitle h4 { line-height: 50px; }
    .phoneBtn { text-align: right; }
        .phoneBtn .btn-default { background-color: #E91E63 !important; color: white }
    .formCheckBoxTitle span { margin-left: 2rem; }


    .app-sidebar { position: absolute; left: 53%; min-height: 70px; width: 100%; }
    .app-sidebar-inner { position: absolute; background: #f8f8f8; border: 1px solid #d1d1d1; /*margin-top: 70px;*/ }
    .app-sidebar .arrow { width: 0; height: 0; border-style: solid; border-width: 6px 7px 6px 0; border-color: transparent #d1d1d1 transparent transparent; position: absolute; left: -6px; top: 19px; }
    .upLoadImg { height: 100%; padding: 10px; }
    .i_Posters { height: 25%; margin-bottom: 2px; border-radius: 5px; border: 1px solid #d1d1d1; }
    .upLoadImg img { height: 100px; width: 100px; }
    .i_Posters > div { display: inline-block; height: 100%; }
    .phoneInput { color: #bfbbbb }
        .phoneInput label { margin-left: 12px; }
        .phoneInput input { height: 40px; margin-bottom: 10px; border: 1px solid #d1d1d1; width: 90%; color: black; }

    .formMsgInputGroup { margin: 15px; }
    .formMsgInput { height: 40px; width: 100%; margin-bottom: 10px; }
        .formMsgInput input { height: 100%; padding: 10px; width: 85%; }
    .formMsgCheckBoxGroup { background-color: #f5f5f9; margin: 15px; }
        .formMsgCheckBoxGroup input { height: 40px; margin-bottom: 10px; border: 1px solid #d1d1d1; }
        .formMsgCheckBoxGroup .formCheckBoxTitle input { margin-top: 10px; }
        .formMsgCheckBoxGroup .CheckBoxGroupsItem { width: 95%; margin-left: 0px; }
            .formMsgCheckBoxGroup .CheckBoxGroupsItem input { width: 89%; }
    .forMsgMenu div { width: 35%; margin-left: 20px; margin-bottom: 5px; }
    .upLoadImgCover { padding: 10px; }
    .set_goodshowtype { padding: 10px; }

    .edui-modal { margin-left: -400px !important; }
    #editor { width: 100% !important; }
    .edui-toolbar { width: 100% !important; }
    .edui-container { width: 100% !important; }
    #appMsg { min-width: 300px; max-width: 700px; }
    .ImgItem img { width: 100%; }
    .editorItem img { width: 100%; }
    .right { padding-right: 0px !important; }
    #edui1_iframeholder { width: 100%; }
</style>
<input type="hidden" id="CName_Hidden" value="小程序" />
<div class="row d-flex" style="height:100%;position:relative;padding-bottom:25%;">
    <div class="left" style="width:25%;height:300px;">
        <h3>添加内容</h3>
        <div class="d-flex d-flex-center" style="flex-wrap:wrap">
            <div class="menuItem bannerMenu"><a href="#">轮播图</a> </div>
            <div class="menuItem formMenu"><a href="#">表单</a></div>
            <div class="menuItem phoneMenu"><a href="#">拨打电话</a></div>
            <div class="menuItem editorMenu"><a href="#">富文本</a></div>
            <div class="menuItem videoMenu"><a href="#">视频</a></div>
            <div class="menuItem ImgMenu"><a href="#">图片</a></div>
            <div class="menuItem MapMenu"><a href="#">地图</a></div>
            <div class="menuItem BmgMenu"><a href="#">背景音乐</a></div>
            <div class="menuItem ADMenu"><a href="#">广告</a></div>
            <div class="menuItem OfficialAccountMenu"><a href="#">关注公众号</a></div>
        </div>

    </div>
    <div class="right d-flex flex-v" style="width:26%;border: 1px solid #d1d1d1;height:100%;position:relative;">

        <div id="header" style="height:60px;background-color:black;" class="Title" data-type="0">
            <div style="height:60px;" class="d-flex d-flex-center">
                <span style="color:white;margin:auto;cursor:pointer;" class="editItem">@(pageIndexModel != null && !string.IsNullOrEmpty(pageIndexModel.PageTitle)&&!string.IsNullOrWhiteSpace(pageIndexModel.PageTitle) ? pageIndexModel.PageTitle : "首页")</span>
            </div>
        </div>
        <div id="txtBody" class="flex d-flex flex-v">

            @{
                if (pageIndexModel != null && !string.IsNullOrEmpty(pageIndexModel.JsonMsg))
                {
                    List<ControlItem> listObj = JsonConvert.DeserializeObject<List<ControlItem>>(pageIndexModel.JsonMsg);
                    foreach (ControlItem item in listObj)
                    {


                        if (item.type == "banner")
                        {



                            List<string> jumpConfigArr = new List<string>();
                            string jumpType = "-1";
                            string jumpConfig = string.Empty;
                            string defaultImg = string.Empty;
                            List<object> banners = item.items;
                            List<bannerItem> listBannerImg = JsonConvert.DeserializeObject<List<bannerItem>>(JsonConvert.SerializeObject(banners));
                            if (listBannerImg != null && listBannerImg.Count > 0)
                            {

                                <div class="bannerItem item">


                                    @for (int i = 0; i < listBannerImg.Count; i++)
                                    {
                                        jumpType = "-1";
                                        jumpConfig = string.Empty;

                                        if (!string.IsNullOrEmpty(listBannerImg[i].link))
                                        {
                                            jumpConfigArr = listBannerImg[i].link.Split(new char[] { ';' }, StringSplitOptions.RemoveEmptyEntries).ToList();
                                            if (jumpConfigArr.Count == 3)
                                            {
                                                jumpType = jumpConfigArr[0];
                                                jumpConfig = jumpConfigArr[1] + ";" + jumpConfigArr[2];

                                            }

                                        }

                                        if (i == 0)
                                        {
                                            <div style="display:none" data-jumptype="@jumpType" data-jumpconfig="@jumpConfig" data-img="@(string.IsNullOrEmpty(listBannerImg[i].imgurl) ? string.Empty : listBannerImg[i].imgurl)" data-sort="0" class="bannerImg"></div>
                                        }
                                        else
                                        {
                                            <div style="display:none" data-jumptype="@jumpType" data-jumpconfig="@jumpConfig" data-img="@listBannerImg[i].imgurl" data-sort="@listBannerImg[i].sort" class="bannerImg"></div>
                                        }


                                    }
                                    @for (int i = listBannerImg.Count; i < 4; i++)
                                    {

                                        <div style="display:none" data-img="" data-sort="@i" class="bannerImg" data-jumptype="-1" data-jumpconfig=""></div>
                                    }


                                    @if (!string.IsNullOrEmpty(listBannerImg[0].imgurl))
                                    {
                                        defaultImg = listBannerImg[0].imgurl;
                                    }



                                    <div class="ItemContent">
                                        <img src="@defaultImg" />
                                    </div>
                                    <div class="footerAction">
                                        <span class="zw"></span><span class="actionItem editItem">编辑</span><span class="actionItem delItem">删除</span>
                                    </div>

                                </div>

                            }


                        }
                        if (item.type == "editor" && item.items.Count > 0)
                        {
                            List<editorItem> listeditorItem = JsonConvert.DeserializeObject<List<editorItem>>(JsonConvert.SerializeObject(item.items));
                            string txt = "富文本编辑器";
                            if (listeditorItem != null)
                            {
                                txt = listeditorItem[0].txt;
                            }
                            <div class="editorItem item">
                                <div style="height:100%;min-height:300px;" class="ItemContent">
                                    @(Html.Raw(txt))
                                </div>

                                <div class="footerAction">
                                    <span class="zw"></span><span class="actionItem editItem">编辑</span><span class="actionItem delItem">删除</span>
                                </div>
                            </div>

                        }
                        if (item.type == "Call" && item.items.Count > 0)
                        {
                            List<phoneItem> listphoneItem = JsonConvert.DeserializeObject<List<phoneItem>>(JsonConvert.SerializeObject(item.items));
                            string phoneTitle = "嫌麻烦?直接电话我们吧";
                            string phoneBtnTitle = "联系我们";
                            string phoneNumber = string.Empty;
                            if (listphoneItem != null && listphoneItem.Count > 0)
                            {
                                phoneTitle = listphoneItem[0].phoneTitle;
                                phoneBtnTitle = listphoneItem[0].phoneBtnTitle;
                                phoneNumber = listphoneItem[0].phoneNumber;
                            }
                            <div class="phoneItem item">
                                <div class="ItemContent">
                                    <div class="phoneTitle">
                                        <h4>@phoneTitle</h4>
                                    </div>
                                    <div class="phoneBtn">
                                        <button type="button" class="btn btn-default ">@phoneBtnTitle</button>
                                        <h1 style="display:none;">@phoneNumber</h1>
                                    </div>
                                </div>

                                <div class="footerAction" style="margin-top:0px;">
                                    <span class="zw"></span><span class="actionItem editItem">编辑</span><span class="actionItem delItem">删除</span>
                                </div>
                            </div>

                        }
                        if (item.type == "form" && item.items.Count > 0)
                        {
                            List<formObjItem> listFormObjItem = JsonConvert.DeserializeObject<List<formObjItem>>(JsonConvert.SerializeObject(item.items));
                            <div class="formItem item">
                                <div class="ItemContent">
                                    <div class="formTitle">@(item.title)</div>
                                    @{
                                        if (listFormObjItem != null && listFormObjItem.Count > 0)
                                        {
                                            List<formItem> listInput = new List<formItem>();
                                            List<formItem> listCheckBox = new List<formItem>();
                                            foreach (formObjItem f in listFormObjItem)
                                            {

                                                foreach (formItem fi in f.items)
                                                {
                                                    if (fi.type == "CheckBox")
                                                    {
                                                        listCheckBox.Add(fi);
                                                    }
                                                    else
                                                    {
                                                        listInput.Add(fi);
                                                    }
                                                }



                                                if (listInput.Count > 0)
                                                {
                                                    <div class="formInputGroup">

                                                        @{
                                                            string filedType = string.Empty;
                                                            foreach (formItem fi in listInput)
                                                            {
                                                                filedType = string.Empty;
                                                                if (fi.type == "NumberPicker")
                                                                {
                                                                    filedType = "NumberPicker";
                                                                }
                                                                if (fi.type == "DateTimePicker")
                                                                {
                                                                    filedType = "DateTimePicker";
                                                                }

                                                                <div class="singleForm form-control formInput @filedType">
                                                                    <label>@fi.filedName</label><input class="formInputItem" maxlength="20" name="Title" type="text" value="">
                                                                </div>
                                                            }
                                                        }

                                                    </div>
                                                                listInput.Clear();
                                                            }

                                                            if (listCheckBox.Count > 0)
                                                            {
                                                                <div class="formCheckBoxGroup singleForm">
                                                                    <div class="formCheckBoxTitle"><span>@f.title</span> </div>
                                                                    <ul class="CheckBoxGroups">
                                                                        @{
                                                                            for (int i = 0; i < listCheckBox.Count; i++)
                                                                            {
                                                                                if (i == 0)
                                                                                {
                                                                                    <li><label class="CheckBoxGroupsItem">@listCheckBox[i].filedName</label><img src="@(WebSiteConfig.cdnurl)content/Miniapp/imgs/gou.png" /></li>
                                                                                }
                                                                                else
                                                                                {
                                                                                    <li><label class="CheckBoxGroupsItem">@listCheckBox[i].filedName</label></li>

                                                                                }
                                                                            }
                                                                        }

                                                                    </ul>
                                                                </div>
                                                                                        listCheckBox.Clear();
                                                                                    }



                                                                                }
                                                                            }
                                    }



                                </div>
                                <div class="footerAction" style="margin-top:0px;">
                                    <span class="zw"></span><span class="actionItem editItem">编辑</span><span class="actionItem delItem">删除</span>
                                </div>
                            </div>
                                                                            }
                                                                            if (item.type == "video")
                                                                            {
                                                                                List<videoItem> listvideoItem = JsonConvert.DeserializeObject<List<videoItem>>(JsonConvert.SerializeObject(item.items));
                                                                                string videoUrl = string.Empty;
                                                                                if (listvideoItem != null)
                                                                                {
                                                                                    videoUrl = listvideoItem[0].videoUrl;
                                                                                    <div class="videoItem item" data-video="@videoUrl" data-img="@listvideoItem[0].videoCover" data-isautoplay="@listvideoItem[0].isAutoPlay">

                                                                                        <div class="ItemContent">

                                                                                            <img src="@(WebSiteConfig.cdnurl)content/Miniapp/imgs/viedeo.png">
                                                                                        </div>

                                                                                        <div class="footerAction">
                                                                                            <span class="zw"></span><span class="actionItem editItem">编辑</span><span class="actionItem delItem">删除</span>
                                                                                        </div>
                                                                                    </div>
                                                                                }


                                                                            }

                                                                            if (item.type == "bmg")
                                                                            {
                                                                                List<AudioItem> listbmgItem = JsonConvert.DeserializeObject<List<AudioItem>>(JsonConvert.SerializeObject(item.items));
                                                                                string bmgUrl = string.Empty;
                                                                                if (listbmgItem != null)
                                                                                {
                                                                                    bmgUrl = listbmgItem[0].bmgPath;
                                                                                    <div class="BmgItem item" data-bmg="@bmgUrl">

                                                                                        <div class="ItemContent" style="text-align:center;">

                                                                                            <img src="@(WebSiteConfig.cdnurl)content/enterprise/img/pageset/bgaudio.png" style="width:30px;">
                                                                                        </div>

                                                                                        <div class="footerAction">
                                                                                            <span class="zw"></span><span class="actionItem editItem">编辑</span><span class="actionItem delItem">删除</span>
                                                                                        </div>
                                                                                    </div>
                                                                                }


                                                                            }


                                                                            if (item.type == "img")
                                                                            {
                                                                                List<imgItem> listimgItem = JsonConvert.DeserializeObject<List<imgItem>>(JsonConvert.SerializeObject(item.items));
                                                                                string imgUrl = string.Empty;
                                                                                if (listimgItem != null)
                                                                                {
                                                                                    imgUrl = listimgItem[0].imgPath;
                                                                                    <div class="ImgItem item" data-img="@imgUrl">

                                                                                        <div class="ItemContent">

                                                                                            <img src="@imgUrl">
                                                                                        </div>

                                                                                        <div class="footerAction">
                                                                                            <span class="zw"></span><span class="actionItem editItem">编辑</span><span class="actionItem delItem">删除</span>
                                                                                        </div>
                                                                                    </div>
                                                                                }


                                                                            }
                                                                             if (item.type == "map")
                                                                            {
                                                                                List<MapItem> listMapItem = JsonConvert.DeserializeObject<List<MapItem>>(JsonConvert.SerializeObject(item.items));

                                                                                if (listMapItem != null)
                                                                                {
                                                                                    <div class="c-map item MapItem" data-locationPoint="@(listMapItem[0].mapLat+","+listMapItem[0].mapLng)" data-addr="@listMapItem[0].mapAddr" data-zoom="@listMapItem[0].zoom">
                                                                                        <div class="ItemContent">
                                                                                            <div class="d-flex d-flex-center mapleader">
                                                                                                <img src="@(WebSiteConfig.cdnurl)content/enterprise/img/pageset/location.png" width="30"> <div class="ml10 flex" style="word-break: break-all;">
                                                                                                    <p class="MapTitle">@item.title</p>
                                                                                                </div> <div><i class="glyphicon glyphicon-menu-right"></i></div>
                                                                                            </div> <div class="c-map-mapimg"><img src="@(WebSiteConfig.cdnurl)content/enterprise/img/pageset/blank_slider_item.png" width="100%"></div>
                                                                                        </div>

                                                                                        <div class="footerAction">
                                                                                            <span class="zw"></span><span class="actionItem editItem">编辑</span><span class="actionItem delItem">删除</span>
                                                                                        </div>
                                                                                    </div>
                                                                                }

                                                                            }

                                                                            if (item.type == "ad")
                                                                            {
                                                                                List<ADItem> listUnitidItem = JsonConvert.DeserializeObject<List<ADItem>>(JsonConvert.SerializeObject(item.items));
                                                                                string unitid = string.Empty;
                                                                                if (listUnitidItem != null)
                                                                                {
                                                                                    unitid = listUnitidItem[0].unitid;
                                                                                    <div class="ADItem item" data-unitid="@unitid">


                                                                                        <div class="ItemContent" style="text-align: center; line-height: 200px; background-color: rgb(204, 204, 204); color: rgb(255, 255, 255);">
                                                                                            设置后在小程序端预览
                                                                                        </div>

                                                                                        <div class="footerAction">
                                                                                            <span class="zw"></span><span class="actionItem editItem">编辑</span><span class="actionItem delItem">删除</span>
                                                                                        </div>
                                                                                    </div>
                                                                                }


                                                                            }


                                                                            if (item.type == "oa")
                                                                            {
                                                                                List<OfficialAccountItem> listOfficialAccountItem = JsonConvert.DeserializeObject<List<OfficialAccountItem>>(JsonConvert.SerializeObject(item.items));
                                                                                int open =0;
                                                                                if (listOfficialAccountItem != null)
                                                                                {
                                                                                    open = listOfficialAccountItem[0].open;
                                                                                    <div class="OfficialAccountItem item" data-open="@open">


                                                                                        <div class="ItemContent" style="text-align: center; line-height: 200px; background-color: rgb(204, 204, 204); color: rgb(255, 255, 255);">
                                                                                            设置后在小程序端预览关注公众号组件
                                                                                        </div>

                                                                                        <div class="footerAction">
                                                                                            <span class="zw"></span><span class="actionItem editItem">编辑</span><span class="actionItem delItem">删除</span>
                                                                                        </div>
                                                                                    </div>
                                                                                        }


                                                                                    }






                                                                                }
                                                                            }

                                                                            else
                                                                            {/*刚刚开通单页版 默认只初始化编辑器一个*/
                                                                                <div class="editorItem item">
                                                                                    <div style="height:100%;min-height:300px;" class="ItemContent">
                                                                                        富文本编辑器
                                                                                    </div>

                                                                                    <div class="footerAction">
                                                                                        <span class="zw"></span><span class="actionItem editItem">编辑</span><span class="actionItem delItem">删除</span>
                                                                                    </div>
                                                                                </div>
                                                                            }
            }







        </div>
        <button type="button" class="btn btn-default" id="btnSave">保存</button>

    </div>
    <div class="app-sidebar " style="display:none;width:45%">

        <div class="app-sidebar-inner">
            <div class="arrow"></div>
            <div id="appMsg">

                <div id="OfficialAccountMsg" style="display:none;">
                    <div style="margin: 10px auto;">
                        <span>关注公众号</span>
                        <label><input type="radio" value="1" name="OfficialAccountOpen" />开启</label>
                        <label><input type="radio" value="0" name="OfficialAccountOpen" />关闭</label>
                    </div>
                  
                </div>

                <div id="ADMsg" style="display:none;">
                    <div style="margin: 10px auto;">
                        <label>广告unit-id:</label>
                        <input class="form-control unitid" name="unitid" type="text" value="" title="请输入广告的unit-id" placeholder="请输入广告的unit-id" style="width:65%!important;display:inline-block;">
                    </div>
                </div>


                <div style="display:none;" id="bannerMsg">

                </div>

                <div style="display:none;" id="editMsg">
                    <div id="editor" style="height:300px;">


                    </div>
                    <div style="color: red;margin-bottom: 20px;">
                        <p><span>图片上传建议：大图宽度为430px，小图宽度为80px，大小不超过1M，格式为jpg或png的图片</span></p>
                    </div>
                </div>


                <div id="formMsg" style="display:none;background-color:white;">

                </div>

                <div style="display:none;" id="phoneMsg">
                    <div>

                        <div class="phoneInput">
                            <label>按钮文字</label>  <input class="formInputItem phoneTxt" maxlength="5" name="Title" type="text" value="" title="5个字符">
                        </div>
                        <div class="phoneInput">
                            <label>联系电话</label> <input class="formInputItem phoneNumber" maxlength="13" name="Title" type="text" value="" title="电话号码">
                        </div>
                    </div>

                </div>

                <div style="display:none;" id="videoMsg">

                </div>

                <div style="display:none;height:50px;" id="pageTitleMsg">
                    <div style="height: 80%;margin-top: 8px;">
                        <label style="margin-left:15px;">标题:</label>  <input title="*最多10个字符" style="border: 1px solid #d1d1d1;width:75%" class="formInputItem" maxlength="10" name="Title" type="text" value="">
                    </div>

                </div>

                <div style="display:none;" id="ImgMsg">

                </div>
                <div style="display:none;" id="MapMsg">

                </div>
                <div style="display:none;" id="bmgMsg">

                    <div class="upLoadImg">
                        <div class="i_Posters">
                            <div style="position:relative;">
                                <img src="@(WebSiteConfig.cdnurl)content/Miniapp/imgs/imageUpload.png" class="defaultUploadBmg" title="点击上传音乐" style="display:block" />
                                <span class="DelPosterBmg" style="position: absolute;right:0px;top: 0px;"><i style="font-size: x-large;cursor: pointer;" class="Hui-iconfont"></i></span>
                            </div>
                        </div>

                    </div>
                    <div style=" color: red;margin-bottom: 20px;">
                        <p><span>音乐文件（MP3）大小不超过10MB</span></p>
                    </div>
                </div>

            </div>

        </div>
    </div>

</div>

<div id="OfficialAccountItemTemp" style="display:none;">
    <div class="OfficialAccountItem item" data-open="">


        <div class="ItemContent" style="text-align: center; line-height: 200px; background-color: rgb(204, 204, 204); color: rgb(255, 255, 255);">
            设置后在小程序端预览关注公众号组件
        </div>

        <div class="footerAction">
            <span class="zw"></span><span class="actionItem editItem">编辑</span><span class="actionItem delItem">删除</span>
        </div>
    </div>
</div>



<div id="ADItemTemp" style="display:none;">
    <div class="ADItem item" data-unitid="">


        <div class="ItemContent" style="text-align: center; line-height: 200px; background-color: rgb(204, 204, 204); color: rgb(255, 255, 255);">
            设置后在小程序端预览
        </div>

        <div class="footerAction">
            <span class="zw"></span><span class="actionItem editItem">编辑</span><span class="actionItem delItem">删除</span>
        </div>
    </div>
</div>

<div id="bannerItemTemp" style="display:none;">
    <div class="bannerItem item">
        <div style="display:none" data-img="" data-sort="0" class="bannerImg" data-jumpType="-1" data-jumpConfig=""></div>
        <div style="display:none" data-img="" data-sort="1" class="bannerImg" data-jumpType="-1" data-jumpConfig=""></div>
        <div style="display:none" data-img="" data-sort="2" class="bannerImg" data-jumpType="-1" data-jumpConfig=""></div>
        <div style="display:none" data-img="" data-sort="3" class="bannerImg" data-jumpType="-1" data-jumpConfig=""></div>
        <div class="ItemContent">
            <img src="@(WebSiteConfig.cdnurl)content/Miniapp/imgs/defaultBanner.png">
        </div>

        <div class="footerAction">
            <span class="zw"></span><span class="actionItem editItem">编辑</span><span class="actionItem delItem">删除</span>
        </div>
    </div>
</div>

<div id="editorItemTemp" style="display:none;">
    <div class="editorItem item">
        <div style="height:100%;min-height:300px;" class="ItemContent">
            富文本编辑器模板
        </div>

        <div class="footerAction">
            <span class="zw"></span><span class="actionItem editItem">编辑</span><span class="actionItem delItem">删除</span>
        </div>
    </div>
</div>

<div id="formItemTemp" style="display:none;">
    <div class="formItem item">
        <div class="ItemContent">
            <div class="formTitle">到店体验</div>
            <div class="formInputGroup">
                <div class="form-control formInput singleForm">
                    <label maxlength="-1">姓名</label><input class="formInputItem" maxlength="20" name="Title" type="text" value="">
                </div>
                <div class="form-control formInput singleForm">
                    <label maxlength="-1">手机</label><input class="formInputItem" maxlength="20" name="Title" type="text" value="">
                </div>
            </div>
            <div class="formCheckBoxGroup singleForm">
                <div class="formCheckBoxTitle"><span>请选择你的性别</span> </div>
                <ul class="CheckBoxGroups">
                    <li><label class="CheckBoxGroupsItem">男</label><img src="@(WebSiteConfig.cdnurl)content/Miniapp/imgs/gou.png" /></li>
                    <li><label class="CheckBoxGroupsItem">女</label></li>
                </ul>

            </div>
        </div>
        <div class="footerAction" style="margin-top:0px;">
            <span class="zw"></span><span class="actionItem editItem">编辑</span><span class="actionItem delItem">删除</span>
        </div>
    </div>
</div>

<div id="phoneItemTemp" style="display:none;">
    <div class="phoneItem item">
        <div class="ItemContent">

            <div class="phoneBtn">
                <button type="button" class="btn btn-default">联系客服</button>
                <h1 style="display:none;"></h1>
            </div>
        </div>

        <div class="footerAction" style="margin-top:0px;">
            <span class="zw"></span><span class="actionItem editItem">编辑</span><span class="actionItem delItem">删除</span>
        </div>
    </div>
</div>

<div id="videoItemTemp" style="display:none;">
    <div class="videoItem item" data-video="">

        <div class="ItemContent">

            <img src="@(WebSiteConfig.cdnurl)content/Miniapp/imgs/viedeo.png">
        </div>

        <div class="footerAction">
            <span class="zw"></span><span class="actionItem editItem">编辑</span><span class="actionItem delItem">删除</span>
        </div>
    </div>
</div>



<div id="ImgItemTemp" style="display:none;">
    <div class="ImgItem item" data-img="">

        <div class="ItemContent">

            <img src="@(WebSiteConfig.cdnurl)content/Miniapp/imgs/defaultBanner.png">
        </div>

        <div class="footerAction">
            <span class="zw"></span><span class="actionItem editItem">编辑</span><span class="actionItem delItem">删除</span>
        </div>
    </div>
</div>



<div id="formBannerMsgTemp" style="display:none;">

    <div class="upLoadImg">
        <div class="i_Posters">
            <span>轮播图1</span>
            <div style="position:relative;">
                <img src="@(WebSiteConfig.cdnurl)content/Miniapp/imgs/imageUpload.png" class="defaultUploadAttr" title="点击上传" style="display:block" />
            </div>

        </div>
        <div class="i_Posters">
            <span>轮播图2</span>
            <div style="position:relative;">
                <img src="@(WebSiteConfig.cdnurl)content/Miniapp/imgs/imageUpload.png" class="defaultUploadAttr" title="点击上传" style="display:block" />
            </div>
        </div>
        <div class="i_Posters">
            <span>轮播图3</span>
            <div style="position:relative;">
                <img src="@(WebSiteConfig.cdnurl)content/Miniapp/imgs/imageUpload.png" class="defaultUploadAttr" title="点击上传" style="display:block" />
            </div>
        </div>
        <div class="i_Posters">
            <span>轮播图4</span>
            <div style="position:relative;">
                <img src="@(WebSiteConfig.cdnurl)content/Miniapp/imgs/imageUpload.png" class="defaultUploadAttr" title="点击上传" style="display:block" />
            </div>
        </div>
    </div>
    <div style=" color: red;margin-bottom: 20px;">
        <p><span>请上传750*400px，大小不超过1M，格式为jpg或png的图片</span></p>
        <p><span>单页版首页路径 pages/shopcar/shopcar</span></p>
        <p><span>餐饮版首页路径 pages/home/home</span></p>
        <p><span>足浴客户端首页路径 pages/book/book</span></p>
        <p><span>其他一切版本首页都是 pages/index/index</span></p>
        <p><span>iOS 微信客户端 6.5.9 版本开始支持，Android 客户端即将在 6.5.10 版本开始支持<br>只有同一公众号下的关联的小程序之间才可相互跳转</span></p>
    </div>

</div>

<div id="formMsgTemp" style="display:none;">
    <div>
        <label style="margin-left: 15px;color:#bfbbbb;">设置表单名称</label>
        <div style="height:40px;">
            <input maxlength="20" type="text" value="到店体验" style="height:100%;width:77%;margin-left:15px;" class="formMsgTitle">
        </div>
    </div>
    <div class="formMsgInputGroup">
        <div class="formMsgInput singleForm">
            <input maxlength="20" type="text" value="姓名">
            <a href="javascript:;" class="delformInputItem">删除</a>
        </div>
        <div class="formMsgInput singleForm">

            <input maxlength="20" type="text" value="手机" />
            <a href="javascript:;" class="delformInputItem">删除</a>
        </div>
    </div>

    <div class="formMsgCheckBoxGroup singleForm">
        <div class="formCheckBoxTitle"><input maxlength="20" type="text" value="请选择你的性别" class="formMsgCheckBoxTitle"><a href="javascript:;" class="delformCkTitleItem">删除</a></div>
        <div class="CheckBoxGroups">
            <div class="CheckBoxGroupsItem">
                <input maxlength="20" type="text" value="男"><a href="javascript:;" class="delformCheckBoxItem">删除</a>
            </div>
            <div class="CheckBoxGroupsItem">
                <input maxlength="20" type="text" value="女" /><a href="javascript:;" class="delformCheckBoxItem">删除</a>
            </div>
            <a href="javascript:;" class="forMsgAddCKItem">+新增选项</a>
        </div>
    </div>
    <div class="d-flex d-flex-center forMsgMenu" style="flex-wrap:wrap">
        <div>
            <a href="javascript:;" class="forMsgMenuInput">+新增输入框</a>
        </div>
        <div>
            <a href="javascript:;" class="forMsgMenuCK">+新增单选框</a>
        </div>
        <div>
            <a href="javascript:;" class="forMsgMenuDateTimePicker">+新增时间选择</a>
        </div>
        <div>
            <a href="javascript:;" class="forMsgMenuNumberPicker">+新增数字选择</a>
        </div>
    </div>
</div>


<div id="ckMsgTemp" style="display:none;">
    <div class="formMsgCheckBoxGroup singleForm">
        <div class="formCheckBoxTitle"><input maxlength="20" type="text" value="请选择你的性别" class="formMsgCheckBoxTitle"><a href="javascript:;" class="delformCkTitleItem">删除</a></div>
        <div class="CheckBoxGroups">

            <div class="CheckBoxGroupsItem"><input maxlength="20" type="text" value="男"><a href="javascript:;" class="delformCheckBoxItem">删除</a></div><div class="CheckBoxGroupsItem"><input maxlength="20" type="text" value="女"><a href="javascript:;" class="delformCheckBoxItem">删除</a></div>
        </div>
        <a href="javascript:;" class="forMsgAddCKItem">+新增选项</a>
    </div>
</div>

<div id="ckTemp" style="display:none;">
    <div class="formCheckBoxGroup singleForm">
        <div class="formCheckBoxTitle"><span>选择你的性别</span> </div>
        <ul class="CheckBoxGroups">
            <li><label class="CheckBoxGroupsItem">男</label><img src="@(WebSiteConfig.cdnurl)content/Miniapp/imgs/gou.png"></li>
            <li><label class="CheckBoxGroupsItem">女</label></li>


        </ul>
    </div>
</div>


<div id="formVideoMsgTemp" style="display:none;">

    <div class="upLoadImg">
        <p>文件</p>
        <div class="i_Posters">
            <div style="position:relative;">
                <img src="@(WebSiteConfig.cdnurl)content/Miniapp/imgs/imageUpload.png" class="defaultUploadVideo" title="点击上传视频" style="display:block" />
                <span class="DelPosterVideo" style="position: absolute;right:0px;top: 0px;"><i style="font-size: x-large;cursor: pointer;" class="Hui-iconfont"></i></span>
            </div>
        </div>

    </div>

    <div class="upLoadImgCover">
        <p>封面</p>
        <div class="i_Posters">
            <div style="position:relative;">
                <img src="@(WebSiteConfig.cdnurl)content/Miniapp/imgs/imageUpload.png" class="defaultUploadSigImg" title="点击上传图片" style="display:block;width:100%;max-height:200px;max-width:400px;">
                <span class="DelPosterVideoCover" style="position: absolute;right:0px;top: 0px;"><i style="font-size: x-large;cursor: pointer;" class="Hui-iconfont"></i></span>
            </div>
        </div>

    </div>
    <div class="set_goodshowtype">
        自动播放:
        <label>
            <input name="isAutoPlay" type="radio" value="1" class="isAutoPlay">开启
        </label> <label>
            <input name="isAutoPlay" type="radio" value="0" class="isAutoPlay"> 关闭
        </label>
    </div>
    <div style=" color: red;margin-bottom: 20px;">
        <p><span>请上传一个大小不超过20MB，建议格式为MP4的视频</span></p>
    </div>

</div>

<div id="formImgMsgTemp" style="display:none;">

    <div class="upLoadImg">
        <div class="i_Posters">
            <div style="position:relative;">
                <img src="@(WebSiteConfig.cdnurl)content/Miniapp/imgs/imageUpload.png" class="defaultUploadSigImg" title="点击上传图片" style="display:block" />
                <span class="DelPosterImg" style="position: absolute;right:0px;top: 0px;"><i style="font-size: x-large;cursor: pointer;" class="Hui-iconfont"></i></span>
            </div>
        </div>

    </div>
    <div style=" color: red;margin-bottom: 20px;">
        <p><span>图片上传建议：大图宽度为430px，小图宽度为80px，大小不超过1M，格式为jpg或png的图片</span></p>
    </div>

</div>

<div id="MapItemTemp" style="display:none;">
    <div class="c-map item MapItem">
        <div class="ItemContent">
            <div class="d-flex d-flex-center mapleader">
                <img src="@(WebSiteConfig.cdnurl)content/enterprise/img/pageset/location.png" width="30"> <div class="ml10 flex" style="word-break: break-all;">
                    <p class="MapTitle">地图引导语</p>
                </div> <div><i class="glyphicon glyphicon-menu-right"></i></div>
            </div> <div class="c-map-mapimg"><img src="@(WebSiteConfig.cdnurl)content/enterprise/img/pageset/blank_slider_item.png" width="100%"></div>
        </div>

        <div class="footerAction">
            <span class="zw"></span><span class="actionItem editItem">编辑</span><span class="actionItem delItem">删除</span>
        </div>
    </div>
</div>

<div id="MapMsgTemp" style="display:none;">
    <div class="set set_map">
        <div class="unit" style="margin-top:1rem;">
            <div class="mt10"><input type="text" placeholder="请输入地图引导语" class="form-control MapMsgTitle"></div> <div class="mt10"><a data-toggle="modal" href="#ChooseLocationModal" class="actionbtn " style="margin-left:1rem;">＋选择地图位置</a></div>
        </div>
    </div>
</div>


<div id="BmgItemTemp" style="display:none;">
    <div class="BmgItem item" data-bmg="">

        <div class="ItemContent" style="text-align:center;">

            <img src="@(WebSiteConfig.cdnurl)content/enterprise/img/pageset/bgaudio.png" style="width:30px;">
        </div>

        <div class="footerAction">
            <span class="zw"></span><span class="actionItem editItem">编辑</span><span class="actionItem delItem">删除</span>
        </div>
    </div>
</div>

<!-- loading -->
<div class="modal fade" id="loading" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" data-backdrop='static'>
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-body" id="modelMsg">
                请稍候,正在处理你的请求.....
            </div>
        </div>
    </div>
</div>


<!-- #region 选择地图位置弹窗 -->
<div class="modal fade" id="ChooseLocationModal" tabindex="-1" role="dialog" aria-labelledby="ChooseLocationModal_label" v-show="selCom()&&selCom().type=='map'">
    <div class="modal-dialog modal-lg" role="document" style="width:1000px;">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="ChooseLocationModal_label">选择地图位置</h4>
            </div>
            <div class="modal-body">
                <iframe name="mapframe" src="/content/plugin/chooselocation/index.html" frameborder="0" width="100%" height="610"></iframe>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" onclick="ChooseLocationOK();">确定</button>
            </div>
        </div>
    </div>
</div>
<!-- #endregion -->




<input id="bmgUrl" type="file" name="bmgUrl" onchange="UploadBmg()" style="height: 0px; width: 0px;opacity:0;" />
<input id="VideoUrl" type="file" name="VideoUrl" onchange="UploadVideo()" style="height: 0px; width: 0px;opacity:0;" />


<div style="display: none;">
    <button id="browse_file_img">上传图片</button>
    <button id="start_upload_img" onclick="uploadFile('img')">开始上传</button>

    <button id="browse_file_video">上传视频</button>
    <button id="start_upload_video" onclick="uploadFile('video')">开始上传</button>

    <button id="browse_file_audio">上传音频</button>
    <button id="start_upload_audio" onclick="uploadFile('audio')">开始上传</button>

</div>


<script src="~/js/ueditor1_4_3_3-utf8-net/utf8-net/ueditor.config.js"></script>
<script src="~/js/ueditor1_4_3_3-utf8-net/utf8-net/ueditor.all.min.js"></script>

<script type="text/javascript" src="@(WebSiteConfig.cdnurl)content/aliosslib/lib/plupload-2.1.2/js/plupload.full.min.js"></script>

<script src="@(WebSiteConfig.cdnurl)content/assets/global/plugins/bootstrap-maxlength/bootstrap-maxlength.min.js"></script>
@*<script src="@(WebSiteConfig.cdnurl)content/Home/js/jquery.min.js"></script>*@
<script src="@(WebSiteConfig.cdnurl)content/Miniapp/js/jquery.dad.min.js"></script>
<script src="@(WebSiteConfig.cdnurl)content/Miniapp/js/ajaxfileupload.js"></script>
@section script{
    <script>

        var TotalCount=@ViewBag.TotalCount;
        var curdelItem;
        var ue;
        var curEditItem;//当前编辑的模块
        var thisUploadImg;//全局变量 保存属性当前点击的的上传图片
        var thisUploadVideo;//全局变量 保存属性当前点击的上传视频
        var thisUploadSigImg;//全局变量 保存属性当前点击的的上传单张图片
        var thisUploadBmg;//全局变量 保存属性当前点击的的上传单张图片
        $(function () {

            //编辑器
            comeditor = UE.getEditor('editor',{
                toolbars: [
                    ['source','|' ,'undo', 'redo' ,'|','bold',' italic',' underline','strikethrough','|','forecolor','backcolor', '|','justifyleft','justifycenter','justifyright','justifyjustify'],
                        ['simpleupload','insertimage','insertvideo','paragraph','fontsize',' |','insertorderedlist','insertunorderedlist','horizontal','autotypeset','pasteplain']

                ],
                imageUrl: "/Upload/Image",
                autoHeight: true
            });

            comeditor.addListener("contentChange", function () {
                setTimeout(function () {
                    console.log("change");
                    if (comeditor.hasContents()) {
                        curEditItem.children().eq(0).html(comeditor.getContent());
                        console.log("编辑变化了");

                    } else {
                        curEditItem.children().eq(0).html('');
                        console.log("编辑变化了但是没有内容");
                    }
                }, 1500);
            });









            $("#formMsg").append($("#formMsgTemp").html());
            $("#bannerMsg").empty().append($("#formBannerMsgTemp").html());
            $("#videoMsg").empty().append($("#formVideoMsgTemp").html());
            $("#ImgMsg").empty().append($("#formImgMsgTemp").html());
            $("#MapMsg").empty().append($("#MapMsgTemp").html());
            $(".bannerMenu").click(function () {
                $("#txtBody").append($("#bannerItemTemp").html())
                $("#bannerMsg").empty().append($("#formBannerMsgTemp").html());

                $(".app-sidebar").css("display", "none");
                $("#appMsg>div").css("display", "none");
            });
            $(".OfficialAccountMenu").click(function () {

                if ($("#txtBody .OfficialAccountItem").length <= 0) {

                    $("#txtBody").append($("#OfficialAccountItemTemp").html())

                    $(".app-sidebar").css("display", "none");
                    $("#appMsg>div").css("display", "none");

                }else{
                    layer.msg("页面中只能添加一个关注公众号组件!");
                    return;
                }
            });

            //广告AD
            $(".ADMenu").click(function () {
                $("#txtBody").append($("#ADItemTemp").html())

                $(".app-sidebar").css("display", "none");
                $("#appMsg>div").css("display", "none");
            });
            $(".editorMenu").click(function () {
                $("#txtBody").append($("#editorItemTemp").html());
                $("#appMsg>div").css("display", "none");
                $(".app-sidebar").css("display", "none");
            });

            $(".formMenu").click(function () {
                //只能有一个表单
                if ($("#txtBody .formItem").length <= 0) {
                    $("#txtBody").append($("#formItemTemp").html());
                    $("#formMsg").empty().append($("#formMsgTemp").html());
                    $("#appMsg>div").css("display", "none");
                    $(".app-sidebar").css("display", "none");
                } else {
                    layer.msg("页面中已经存在表单了!");
                    return;
                }
            });

            $(".phoneMenu").click(function () {
                if($("#txtBody .phoneItem").length>0){
                    layer.msg("页面中已经存在拨打电话组件了!");
                    return;
                }
                $("#txtBody").append($("#phoneItemTemp").html());
                $("#appMsg>div").css("display", "none");
                $(".app-sidebar").css("display", "none");
            });

            $(".videoMenu").click(function () {
                $("#txtBody").append($("#videoItemTemp").html())

                $(".app-sidebar").css("display", "none");
                $("#appMsg>div").css("display", "none");
            });

            $(".ImgMenu").click(function () {
                $("#txtBody").append($("#ImgItemTemp").html())

                $(".app-sidebar").css("display", "none");
                $("#appMsg>div").css("display", "none");
            });

            $(".MapMenu").click(function () {
                $("#txtBody").append($("#MapItemTemp").html())
                $(".app-sidebar").css("display", "none");
                $("#appMsg>div").css("display", "none");
            });
            $(".BmgMenu").click(function () {

                //只能有一个表单
                if ($("#txtBody .BmgItem").length <= 0) {
                    $("#txtBody").append($("#BmgItemTemp").html())
                    $(".app-sidebar").css("display", "none");
                    $("#appMsg>div").css("display", "none");
                } else {
                    layer.msg("页面中已经存在背景音乐了!");
                    return;
                }


            });

            /*拖拽事件*/
            $("#txtBody").dad({
                draggable: ".ItemContent",
                callback: function () {
                    $(".app-sidebar ").css("display", "none");
                }

            });
            $(".menuItem").click(function () {
                $("#txtBody").dad({
                    draggable: ".ItemContent",
                    callback: function () {
                        $(".app-sidebar ").css("display", "none");
                    }

                });
            });


            $(document).on("change", ".selectType", function () {
                //轮播图导航
                var jumpTyp=$(this).val();
                console.log(jumpTyp);
                var index = $(".selectType").index($(this));
                $(curEditItem.find(".bannerImg")).eq(index).data("jumptype",jumpTyp);
                //  $(this).parent().find("input").val("");
                if(jumpTyp==1){

                    $(this).parent().next().css("display","block");
                }else{
                    //隐藏
                    $(this).parent().next().css("display","none");

                }

            }).on("keyup", ".jumpDetailApp .jumpAppId", function () {
                // 设置跳转appId
                var index = $(".jumpDetailApp .jumpAppId").index($(this));
                var jumpconfig=$(this).val().trim()+";"+$(this).parent().next().find(".jumpPath").val().trim();
                $(curEditItem.find(".bannerImg")).eq(index).data("jumpconfig",jumpconfig);

            }).on("keyup", ".jumpDetailApp .jumpPath", function () {
                // 设置跳转路径
                var index = $(".jumpDetailApp .jumpPath").index($(this));
                var jumpconfig=$(this).parent().prev().find(".jumpAppId").val().trim()+";"+$(this).val().trim();
                $(curEditItem.find(".bannerImg")).eq(index).data("jumpconfig",jumpconfig);

            }).on("click", ".delItem", function () {
                /*删除模块*/
                curdelItem=$(this);

                $(this).parent().parent().remove();
                $(".app-sidebar").css("display", "none");

            }).on("click", ".editItem", function () {
                curEditItem = $(this).parent().parent();//确定当前点击的控件

                var t=$(this).parent().parent().position().top;

                if (curEditItem.hasClass("editorItem")) {
                    comeditor.setContent(curEditItem.children().eq(0).html());
                    $("#editMsg").css("display", "block").siblings().css("display", "none");

                }
                if (curEditItem.hasClass("ADItem")) {
                    if($(curEditItem).data("unitid")!=''||$(curEditItem).data("unitid")!=undefined){

                        $("#ADMsg .unitid").val($(curEditItem).data("unitid"));
                    }
                    
                    $("#ADMsg").css("display", "block").siblings().css("display", "none");

                }

                if (curEditItem.hasClass("OfficialAccountItem")) {
                    if($(curEditItem).data("open")!=''&&$(curEditItem).data("open")!=undefined){
                        $("input[name='OfficialAccountOpen'][value='"+parseInt($(curEditItem).data("open"))+"']").attr("checked",true); 
                    }else{
                        $("input[name='OfficialAccountOpen'][value=0]").attr("checked",true); 

                    }
                    
                    $("#OfficialAccountMsg").css("display", "block").siblings().css("display", "none");

                }

                if (curEditItem.hasClass("phoneItem")) {
                    $("#phoneMsg").find(".phoneTip").val(curEditItem.find("h4").html());
                    $("#phoneMsg").find(".phoneTxt").val(curEditItem.find("button").html());
                    $("#phoneMsg").find(".phoneNumber").val(curEditItem.find("h1").html());
                    $("#phoneMsg").css("display", "block").siblings().css("display", "none");

                }
                if (curEditItem.hasClass("bannerItem")) {
                    $("#bannerMsg .upLoadImg").empty();
                    var jumpSelect,appIdInput
                    curEditItem.find(".bannerImg").each(function (i, item) {

                        if ($(item).data("img") != '') {
                            var isSelected,display="none",appId="",appPath="pages/index/index";
                            if($(item).data("jumptype")=="1"){

                                isSelected="selected";
                                display="block";
                                appId=$(item).data("jumpconfig").split(";")[0];
                                appPath=$(item).data("jumpconfig").split(";")[1];
                            }
                            jumpSelect="<div>导航：<select name=\"selectType\" class=\"selectType\"><option value=\"-1\">不跳转</option><option value=\"1\" "+isSelected+">跳转到小程序</option></select></div>";
                            appIdInput="<div class=\"jumpDetailApp\" style=\"margin-left:20px;display:"+display+";\"><div class=\"d-flex-center d-flex\" style=\"margin-bottom:5px;\"><span style=\"width:40%;text-align:right;\">AppId：</span><input class=\"jumpAppId\" title=\"小程序appId\" placeholder=\"小程序AppId\"  type=\"text\" value=\""+appId+"\"></div><div class=\"d-flex-center d-flex\"><span style=\"width:40%;text-align:right;\">页面路径：</span><input class=\"jumpPath\" title=\"小程序首页\" placeholder=\"小程序首页\"  type=\"text\" value=\""+appPath+"\"><div></div>";

                            $("#bannerMsg .upLoadImg").append(" <div class=\"i_Posters d-flex-center d-flex\"><span></span><div style=\"position:relative;\"><img src=\"@(WebSiteConfig.cdnurl)content/Miniapp/imgs/imageUpload.png\" class=\"defaultUploadAttr\" title=\"点击上传\" style=\"display:none\" /><img src=\"" + $(item).data("img") + "\" title=\"删除此张重新上传\" style=\"display:block\" /><span class=\"DelPoster\" style=\"position: absolute;right:0px;top: 0px;\"><i style=\"font-size: x-large;cursor: pointer;\" class=\"Hui-iconfont\">&#xe706;</i></span></div>"+jumpSelect+""+appIdInput+"</div>");
                        } else {
                            jumpSelect="<div>导航：<select name=\"selectType\" class=\"selectType\"><option value=\"-1\">不跳转</option><option value=\"1\">跳转到小程序</option></select></div>";
                            appIdInput="<div class=\"jumpDetailApp\" style=\"margin-left:20px;display:none;\"><div style=\"margin-bottom:5px;\" class=\"d-flex-center d-flex\"><span style=\"width:40%;text-align:right;\">AppId：</span><input class=\"jumpAppId\" title=\"小程序appId\" placeholder=\"小程序AppId\"  type=\"text\" value=\"\"></div><div class=\"d-flex-center d-flex\"><span style=\"width:40%;text-align:right;\">页面路径：</span><input class=\"jumpPath\" title=\"小程序首页\" placeholder=\"小程序首页\"  type=\"text\" value=\"pages/index/index\"><div></div>";

                            $("#bannerMsg .upLoadImg").append(" <div class=\"i_Posters d-flex-center d-flex\"><span></span><div style=\"position:relative;\"><img src=\"@(WebSiteConfig.cdnurl)content/Miniapp/imgs/imageUpload.png\" class=\"defaultUploadAttr\" title=\"点击上传\" style=\"display:block\" /></div>"+jumpSelect+""+appIdInput+"</div>");
                        }

                    });

                    $("#bannerMsg").css("display", "block").siblings().css("display", "none");

                }

                if (curEditItem.hasClass("formItem")) {
                    $("#formMsg .formMsgInputGroup .formMsgInput").remove();
                    $("#formMsg .formMsgCheckBoxGroup").remove();
                    $("#formMsg").find(".formMsgTitle").val(curEditItem.find(".formTitle").html());

                    var itemType='';
                    curEditItem.find(".formInputGroup .formInput ").each(function (i, item) {
                        if ($(item).hasClass("NumberPicker")) {
                            itemType = "NumberPicker";
                        }
                        if ($(item).hasClass("DateTimePicker")) {
                            itemType = "DateTimePicker";
                        }

                        $("#formMsg .formMsgInputGroup").append("<div class=\"singleForm formMsgInput " + itemType + "\"><input class=\"filed\" maxlength=\"20\" type=\"text\" value=\"" + $(item).find("label").html() + "\"><a href=\"javascript:;\" class=\"delformInputItem\">删除</a></div>");

                    });

                    curEditItem.find(".formCheckBoxGroup").each(function () {
                        var ckGroup = $(this);
                        var msgCk = "<div class=\"singleForm formMsgCheckBoxGroup\"><div class=\"formCheckBoxTitle\"><input maxlength=\"20\" type=\"text\" value=\"" + ckGroup.find("span").html() + "\" class=\"formMsgCheckBoxTitle\"><a href=\"javascript:;\" class=\"delformCkTitleItem\">删除</a></div>";
                        msgCk += "<div class=\"CheckBoxGroups\">";
                        ckGroup.find(".CheckBoxGroupsItem").each(function (i, item) {
                            msgCk += "<div class=\"CheckBoxGroupsItem\"><input maxlength=\"20\" type=\"text\" value=\""+$(item).html()+"\"><a href=\"javascript:;\" class=\"delformCheckBoxItem\">删除</a></div>";
                        });
                        msgCk += "</div><a href=\"javascript:;\" class=\"forMsgAddCKItem\">+新增选项</a></div>";
                        $("#formMsg .forMsgMenu").before($(msgCk));
                    });


                    //if(parseInt(TotalCount)>0){
                    //    $("#formMsg .singleForm input").attr("disabled","disabled");
                    //    $("#formMsg .delformInputItem").remove();
                    //    $("#formMsg .forMsgAddCKItem").remove();
                    //    $("#formMsg .forMsgMenuInput").parent().remove();
                    //    $("#formMsg .forMsgMenuCK").parent().remove();
                    //    $("#formMsg .forMsgMenuDateTimePicker").parent().remove();
                    //    $("#formMsg .forMsgMenuNumberPicker").parent().remove();
                    //    $("#formMsg .delformCkTitleItem").remove();
                    //    $("#formMsg .delformCheckBoxItem").remove();

                    //    $("#formMsg .forMsgMenu").append("<span style=\"color: red;\">*存在表单数据后不能再修改表单结构,如果需要修改请删除重建</span>");

                    //}



                    $("#formMsg").css("display", "block").siblings().css("display", "none");

                }


                if (curEditItem.hasClass("videoItem")) {

                    if($(curEditItem).data("video")!=''){
                        $("#videoMsg .upLoadImg").find("img").attr("src","@(WebSiteConfig.cdnurl)content/Miniapp/imgs/viedeo.png");
                        $("#videoMsg .DelPosterVideo").css("display", "block");
                    }else{
                        $("#videoMsg .upLoadImg").find("img").attr("src","@(WebSiteConfig.cdnurl)content/Miniapp/imgs/imageUpload.png");

                        $("#videoMsg .DelPosterVideo").css("display", "none");

                    }


                    //封面
                    if($(curEditItem).data("img")==''||$(curEditItem).data("img")==undefined){
                        $("#videoMsg .upLoadImgCover").find("img").attr("src","@(WebSiteConfig.cdnurl)content/Miniapp/imgs/imageUpload.png");

                        $("#videoMsg .DelPosterVideoCover").css("display", "none");


                    }else{

                        $("#videoMsg .upLoadImgCover").find("img").attr("src",$(curEditItem).data("img"));
                        $("#videoMsg .DelPosterVideoCover").css("display", "block");
                    }

                    var autoPalyVideo=parseInt($(curEditItem).data("isautoplay"));
                    if(autoPalyVideo>0){
                        $("#videoMsg .isAutoPlay").eq(0).click();
                    }else{
                        $("#videoMsg .isAutoPlay").eq(1).click();
                    }


                    $("#videoMsg").css("display", "block").siblings().css("display", "none");


                }


                if (curEditItem.hasClass("ImgItem")) {

                    if($(curEditItem).data("img")!=''){
                        $("#ImgMsg .upLoadImg").find("img").attr("src",$(curEditItem).data("img"));
                        $("#ImgMsg .DelPosteImgr").css("display", "block");
                    }else{
                        $("#ImgMsg .upLoadImg").find("img").attr("src","@(WebSiteConfig.cdnurl)content/Miniapp/imgs/imageUpload.png");

                        $("#ImgMsg .DelPosterImg").css("display", "none");

                    }


                    $("#ImgMsg").css("display", "block").siblings().css("display", "none");

                }

                if (curEditItem.hasClass("MapItem")) {

                    $("#MapMsg").empty().append($("#MapMsgTemp").html());
                    $("#MapMsg .MapMsgTitle").val( curEditItem.find(".MapTitle").html());
                    $("#MapMsg .actionbtn").html("+"+curEditItem.data("addr")=='undefined'?"添加位置":curEditItem.data("addr"));
                    $("#MapMsg").css("display", "block").siblings().css("display", "none");

                }

                if (curEditItem.hasClass("BmgItem")) {


                    if($(curEditItem).data("bmg")!=''){
                        $("#bmgMsg .upLoadImg").find("img").attr("src","@(WebSiteConfig.cdnurl)content/Miniapp/imgs/bmg.png");
                        $("#bmgMsg .DelPosterBmg").css("display", "block");
                    }else{
                        $("#bmgMsg .upLoadImg").find("img").attr("src","@(WebSiteConfig.cdnurl)content/Miniapp/imgs/imageUpload.png");

                        $("#bmgMsg .DelPosterBmg").css("display", "none");

                    }


                    $("#bmgMsg").css("display", "block").siblings().css("display", "none");


                }



                console.log(parseInt(t));
                var totalTop = (parseInt(t) + 70) + "px";
                if(curEditItem.hasClass("Title")){
                    totalTop = parseInt(t) + "px";
                    $("#pageTitleMsg input").val($(this).html());
                    $("#pageTitleMsg").css("display", "block").siblings().css("display", "none");
                }


                console.log(totalTop);
                $(".app-sidebar").css("display", "block");
                $(".app-sidebar-inner").css("top", totalTop)




            }).on("keyup", ".MapMsgTitle", function () {
                curEditItem.find(".MapTitle").html($(this).val());

            }).on("click", ".defaultUploadAttr", function () {
                //上传图片点击

                thisUploadImg = $(this);
                $('#browse_file_img').click();
            }).on("click", ".defaultUploadVideo", function () {
                //上传视频点击

                thisUploadVideo = $(this);
                $('#browse_file_video').click();
            }).on("click", ".defaultUploadSigImg", function () {
                //上传单张图片

                thisUploadSigImg = $(this);

                $('#browse_file_img').click();
            }).on("click", ".defaultUploadBmg", function () {
                //上传音频点击

                thisUploadBmg = $(this);
                $('#browse_file_audio').click();
            }).on("keyup", "#pageTitleMsg input", function () {
                curEditItem.find("span").html($(this).val());

            }) .on("keyup", ".unitid", function () {

                curEditItem.data("unitid",$(this).val());
            }) .on("keyup", ".phoneTip", function () {

                curEditItem.find("h4").html($(this).val());
            }).on("keyup", ".phoneNumber", function () {
                var reg = /^[0-9]\d*$/;
                if (!reg.test($(this).val())) {
                    $(this).val('');
                    return;
                }
                curEditItem.find("h1").html($(this).val());

            }).on("keyup", ".phoneTxt", function () {
                curEditItem.find("button").html($(this).val());

            }).on("keyup", "#formMsg .formMsgTitle", function () {
                curEditItem.find(".formTitle").html($(this).val());

            }).on("keyup", ".formMsgInput .filed", function () {
                var indexInput = $(".formMsgInput .filed").index($(this));

                $(curEditItem.find(".formInputGroup label")[indexInput]).html($(this).val());

            }).on("keyup", "#formMsg .formMsgCheckBoxTitle", function () {
                var index = $("#formMsg .formMsgCheckBoxTitle").index($(this));
                $(curEditItem.find(".formCheckBoxTitle span")).eq(index).html($(this).val());

            }).on("keyup", "#formMsg .CheckBoxGroupsItem input", function () {
                //表单编辑框 单选框
                var indexInput = $("#formMsg .CheckBoxGroupsItem input").index($(this));
                console.log(indexInput);
                $(curEditItem.find(".CheckBoxGroups label")[indexInput]).html($(this).val());

            }).on("click", ".delformInputItem", function () {
                //表单输入框 删除
                var indexInput = $(".formMsgInput input").index($(this).prev());
                console.log(indexInput);
                $(this).parent().remove();
                $(curEditItem.find(".formInputGroup .formInput")[indexInput]).remove();
            }).on("click", "#formMsg .delformCkTitleItem", function () {
                //表单单选 标题 删除指定的总单选框

                var index = $("#formMsg .formMsgCheckBoxGroup").index($(this).parent().parent());
                curEditItem.find(".formCheckBoxGroup")[index].remove();
                $(this).parent().parent().remove();

            }).on("click", ".delformCheckBoxItem", function () {
                //表单单选 删除
                var indexInput = $(".formMsgCheckBoxGroup .CheckBoxGroupsItem input").index($(this).prev());
                console.log(indexInput);
                $(this).parent().remove();
                $(curEditItem.find(".CheckBoxGroups li")[indexInput]).remove();
            }).on("click", "#formMsg .forMsgMenuInput", function () {
                var formIntemCount = $("#formMsg .formMsgInput ").length + $("#formMsg .CheckBoxGroupsItem ").length;
                //   console.log(formIntemCount);
                if (formIntemCount >= 10) {
                    layer.msg("所有表单项不能大于10个!");
                    return;
                }

                if ($(curEditItem.find(".formInputGroup")).length == 0) {
                    $(curEditItem.find(".formTitle")).after($("<div class=\"formInputGroup\"></div>"));
                }

                //编辑框 新增输入框
                $("#formMsg .formMsgInputGroup").append($("<div class=\"formMsgInput\"><input maxlength=\"20\" type=\"text\" value=\"姓名\" class=\"filed\"><a href=\"javascript:;\" class=\"delformInputItem\">删除</a></div>"));
                $(curEditItem.find(".formInputGroup")).append($("<div class=\"singleForm form-control formInput\"><label maxlength=\"-1\">姓名</label><input class=\"formInputItem\" maxlength=\"20\" name=\"Title\" type=\"text\" value=\"\"></div>"));

            }).on("click", "#formMsg .forMsgMenuDateTimePicker", function () {
                var formIntemCount = $("#formMsg .formMsgInput ").length + $("#formMsg .CheckBoxGroupsItem ").length;
                if (formIntemCount >= 10) {
                    layer.msg("所有表单项不能大于10个!");
                    return;
                }
                if ($(curEditItem.find(".formInputGroup")).length == 0) {
                    $(curEditItem.find(".formTitle")).after($("<div class=\"formInputGroup\"></div>"));
                }
                //编辑框 新增时间框
                $("#formMsg .formMsgInputGroup").append($("<div class=\"formMsgInput DateTimePicker\"><input class=\"filed\" maxlength=\"20\" type=\"text\" value=\"选择时间\"><a href=\"javascript:;\" class=\"delformInputItem\">删除</a></div>"));
                $(curEditItem.find(".formInputGroup")).append($("<div class=\"singleForm form-control formInput DateTimePicker\"><label>选择时间</label><input class=\"formInputItem\" maxlength=\"20\" name=\"Title\" type=\"text\" value=\"\"></div>"));

            }).on("click", "#formMsg .forMsgMenuNumberPicker", function () {
                //编辑框 新增数字输入框
                var formIntemCount = $("#formMsg .formMsgInput ").length + $("#formMsg .CheckBoxGroupsItem ").length;
                if (formIntemCount >= 10) {
                    layer.msg("所有表单项不能大于10个!");
                    return;
                }
                if ($(curEditItem.find(".formInputGroup")).length == 0) {
                    $(curEditItem.find(".formTitle")).after($("<div class=\"formInputGroup\"></div>"));
                }
                $("#formMsg .formMsgInputGroup").append($("<div class=\"formMsgInput NumberPicker\"><input class=\"filed\" maxlength=\"20\" type=\"text\" value=\"选择数字\"><a href=\"javascript:;\" class=\"delformInputItem\">删除</a></div>"));
                $(curEditItem.find(".formInputGroup")).append($("<div class=\"singleForm form-control formInput NumberPicker\"><label>选择数字</label><input class=\"formInputItem\" maxlength=\"20\" name=\"Title\" type=\"text\" value=\"\"></div>"));

            }).on("click", "#formMsg .forMsgMenuCK", function () {
                //编辑框 新增单选框
                var formIntemCount = $("#formMsg .formMsgInput ").length + $("#formMsg .CheckBoxGroupsItem ").length;
                if (formIntemCount >= 9) {
                    layer.msg("所有表单项不能大于10个!");
                    return;
                }

                $("#formMsg .forMsgMenu").before($("#ckMsgTemp").html());
                $(curEditItem.find(".ItemContent ")).append($("#ckTemp").html());

            }).on("click", "#formMsg .forMsgAddCKItem", function () {
                //编辑框 新增单选框选项子项
                var formIntemCount = $("#formMsg .formMsgInput ").length + $("#formMsg .CheckBoxGroupsItem ").length;
                if (formIntemCount >= 10) {
                    layer.msg("所有表单项不能大于10个!");
                    return;
                }

                $(this).prev().append($("<div class=\"CheckBoxGroupsItem\"><input maxlength=\"20\" type=\"text\" value=\"男\"><a href=\"javascript:;\" class=\"delformCheckBoxItem\">删除</a></div>"));

                var index = $("#formMsg .formMsgCheckBoxGroup").index($(this).parent());
                $(curEditItem.find(".formCheckBoxGroup .CheckBoxGroups")).eq(index).append($("<li><label class=\"CheckBoxGroupsItem\">男</label></li>"));

            }).on("click", ".DelPoster", function () {
                //删除图片
                //  $(this).prev().attr("src", "@(WebSiteConfig.cdnurl)content/Miniapp/imgs/imageUpload.png");
                var curIndex = $("#bannerMsg .DelPoster").index($(this));
                $(curEditItem.find(".bannerImg")[curIndex]).data("img", "");
                $(this).prev().prev().css("display","block");
                $(this).prev().remove();
                $(this).remove();

            }).on("click", ".DelPosterImg", function () {
                //删除单张图片

                $(curEditItem).data("img", "");
                $(this).prev().attr("src","@(WebSiteConfig.cdnurl)content/Miniapp/imgs/imageUpload.png");
                $(this).css("display","none");

            }).on("click", ".DelPosterVideo", function () {
                //删除视频

                $(curEditItem).data("video", "");
                $(this).prev().attr("src","@(WebSiteConfig.cdnurl)content/Miniapp/imgs/imageUpload.png");
                $(this).css("display","none");

            }).on("click", ".DelPosterVideoCover", function () {
                //删除视频封面图

                $(curEditItem).data("img", "");
                $(this).prev().attr("src","@(WebSiteConfig.cdnurl)content/Miniapp/imgs/imageUpload.png");
                $(this).css("display","none");

            }).on("click", ".DelPosterBmg", function () {

                //删除音频
                $(this).prev().attr("src","@(WebSiteConfig.cdnurl)content/Miniapp/imgs/imageUpload.png");
                $(this).css("display","none");
                $(curEditItem).data("bmg", "");


            }).on("click", ".isAutoPlay", function () {
                $(curEditItem).data("isautoplay", $(this).val());
                console.log($(this).val());
            }).on("click", "#btnSave", function () {
                //获取页面信息 保存
                var saveObj = [];
                var isSubmit=true;
                //轮播图开始

                var bannerObj = {
                    title: "",
                    type: "banner",
                    items: [],
                    sys_order: 0
                };
                var bannerItem = {
                    imgurl: "",
                    link: "",
                    sort: 0
                };

                //遍历轮播图组件
                $("#txtBody .bannerItem").each(function (k, itembanner) {
                    var obj = $(this);

                    bannerObj = {
                        title: "",
                        type: "banner",
                        items: [],
                        sys_order: 0
                    };
                    $(obj.find(".bannerImg")).each(function (i, item) {
                        if($(item).data("img")!=''){
                            var jumpconfig=$(item).data("jumpconfig");
                            var jumpType=$(item).data("jumptype");
                            if(jumpType!=''&&parseInt(jumpType)==1){
                                //表示选择跳转到小程序
                                var jumpconfigArr=jumpconfig.trim().split(";");

                                if(jumpconfigArr[0]==""||jumpconfigArr[1]==""){
                                    layer.msg("第"+(k+1)+"个轮播图组件下第"+(i+1)+"张轮播图有跳转的appId或者页面未填!");
                                    isSubmit=false;
                                    return;
                                }
                            }else{
                                jumpType=-1;
                                jumpconfig="";
                            }


                            bannerItem = {
                                imgurl: $(item).data("img"),
                                link: jumpType+";"+jumpconfig,
                                sort: parseInt($(item).data("sort"))
                            };
                            bannerObj.items.push(bannerItem);
                        }

                    });


                    bannerObj.sys_order = parseInt(obj.attr("data-dad-position"));
                    if(bannerObj.items.length>0){
                        saveObj.push(bannerObj);
                    }


                });



                //轮播图结束

                //遍历编辑器开始

                var editorObj = {
                    title: "",
                    type: "editor",
                    items: [],
                    sys_order: 0
                };

                var editorItem = {
                    txt: ""
                }

                $("#txtBody .editorItem ").each(function () {
                    var obj = $(this);
                    editorObj = {
                        title: "",
                        type: "editor",
                        items: [],
                        sys_order: parseInt(obj.attr("data-dad-position"))
                    };
                    editorItem = {
                        txt: obj.children().eq(0).html()
                    }
                    editorObj.items.push(editorItem);
                    saveObj.push(editorObj);
                });


                //遍历编辑器结束

                //遍历表单

                var formObj = {
                    type: "form",
                    title: "",
                    items: [],
                    sys_order: 0
                };

                var formObjItem = {
                    title: "",
                    items: []
                };

                var formItem = {
                    type: "",
                    filedName: "",
                    sys_index: 0
                }
                $("#txtBody .formItem ").each(function () {
                    var obj = $(this);
                    formObj = {
                        type: "form",
                        title: obj.find(".formTitle").html(),
                        items: [],
                        sys_order: parseInt(obj.attr("data-dad-position"))
                    };


                    formObjItem = {
                        title: "",
                        items: []
                    };
                    if (obj.find(".formInput").length > 0) {
                        obj.find(".formInput").each(function () {
                            var objInput = $(this);
                            formItem = {
                                type: "",
                                filedName: objInput.find("label").html(),
                                sys_index: $("#txtBody .formItem").find(".singleForm").index(objInput),

                            }
                            if (objInput.hasClass("DateTimePicker")) {
                                formItem.type = "DateTimePicker"//表示时间选择框
                            } else if (objInput.hasClass("NumberPicker")) {
                                formItem.type = "NumberPicker"//表示数字选择框
                            } else {
                                formItem.type = "formInput";//表示输入文本框
                            }
                            formObjItem.items.push(formItem);
                        });
                        formObj.items.push(formObjItem);
                    }

                    if (obj.find(".formCheckBoxGroup").length > 0) {
                        obj.find(".formCheckBoxGroup").each(function () {
                            var ckGroup = $(this);
                            formObjItem = {
                                title: ckGroup.find("span").html(),
                                items: []
                            };

                            ckGroup.find(".CheckBoxGroupsItem").each(function (i,item) {
                                formItem = {
                                    type: "CheckBox",
                                    filedName: $(item).html(),
                                    sys_index: $("#txtBody .formItem ").find(".singleForm").index($(item).parent().parent().parent())
                                }
                                formObjItem.items.push(formItem);
                            });

                            formObj.items.push(formObjItem);
                        });


                    }

                    saveObj.push(formObj);
                });



                //遍历拨打电话组件

                var phoneObj = {
                    title: "",
                    type: "Call",
                    items: [],
                    sys_order: 0
                };
                var phoneItem = {
                    phoneTitle: "",
                    phoneBtnTitle: "",
                    phoneNumber: "",
                }

                if ($("#txtBody .phoneItem").length > 0) {
                    $("#txtBody .phoneItem").each(function () {
                        var obj = $(this);
                        if(obj.find("h1").html()!=''){


                            phoneObj = {
                                title: "",
                                type: "Call",
                                items: [],
                                sys_order: parseInt(obj.attr("data-dad-position"))
                            };
                            phoneItem = {
                                phoneTitle: obj.find("h4").html(),
                                phoneBtnTitle: obj.find("button").html(),
                                phoneNumber: obj.find("h1").html()
                            }
                            phoneObj.items.push(phoneItem);

                            saveObj.push(phoneObj);
                        }
                    });
                }


                //遍历视频组件
                var videoObj = {
                    title: "",
                    type: "video",
                    items: [],
                    sys_order: 0
                };

                var videoItem = {
                    videoUrl: "",
                    videoCover:"",
                    isAutoPlay:0
                }

                if ($("#txtBody .videoItem").length > 0) {
                    $("#txtBody .videoItem").each(function () {
                        var obj = $(this);
                        if(obj.data("video")!=''){
                            videoObj = {
                                title: "",
                                type: "video",
                                items: [],
                                sys_order: parseInt(obj.attr("data-dad-position"))
                            };
                            videoItem = {
                                videoUrl: obj.data("video"),
                                videoCover:obj.data("img"),
                                isAutoPlay:parseInt(obj.data("isautoplay"))
                            }
                            videoObj.items.push(videoItem);
                            saveObj.push(videoObj);
                        }

                    });
                }

                //遍历视频组件结束


                //遍历图片组件
                var imgObj = {
                    title: "",
                    type: "img",
                    items: [],
                    sys_order: 0
                };

                var imgItem = {
                    imgPath: ""
                }

                if ($("#txtBody .ImgItem").length > 0) {
                    $("#txtBody .ImgItem").each(function () {
                        var obj = $(this);
                        if(obj.data("img")!=''){
                            imgObj = {
                                title: "",
                                type: "img",
                                items: [],
                                sys_order: parseInt(obj.attr("data-dad-position"))
                            };
                            imgItem = {
                                imgPath: obj.data("img")
                            }
                            imgObj.items.push(imgItem);
                            saveObj.push(imgObj);
                        }

                    });
                }

                //遍历图片结束


                //页面标题开始


                var pageTitle=$("#header span").html();
                if(pageTitle=='')
                    pageTitle="首页";



                //遍历地图组件
                var mapObj = {
                    title: "",
                    type: "map",
                    items: [],
                    sys_order: 0
                };

                var mapItem = {
                    mapLat: "",
                    mapLng:"",
                    mapAddr:"",
                    mapZoom:15
                }


                if ($("#txtBody .MapItem").length > 0) {
                    $("#txtBody .MapItem").each(function () {
                        var obj = $(this);
                        if(obj.data("locationpoint")!=''&&obj.data("locationpoint")!=undefined){
                            mapObj = {
                                title: obj.find(".MapTitle").html(),
                                type: "map",
                                items: [],
                                sys_order: parseInt(obj.attr("data-dad-position"))
                            };
                            var mapPoint=obj.data("locationpoint").split(',');
                            mapItem = {
                                mapLat:mapPoint[0] ,
                                mapLng:mapPoint[1] ,
                                mapAddr: obj.data("addr"),
                                mapZoom:parseInt(obj.data("zoom"))
                            }
                            mapObj.items.push(mapItem);
                            saveObj.push(mapObj);
                        }else{

                            isSubmit=false;
                            layer.msg("请先选择地图坐标!");
                            return;
                        }

                    });
                }



                //遍历地图组件结束


                //遍历音频组件
                var bmgObj = {
                    title: "",
                    type: "bmg",
                    items: [],
                    sys_order: 0
                };

                var bmgItem = {
                    bmgPath: ""
                }

                if ($("#txtBody .BmgItem").length > 0) {
                    $("#txtBody .BmgItem").each(function () {
                        var obj = $(this);
                        if(obj.data("bmg")!=''){
                            bmgObj = {
                                title: "",
                                type: "bmg",
                                items: [],
                                sys_order: parseInt(obj.attr("data-dad-position"))
                            };
                            bmgItem = {
                                bmgPath: obj.data("bmg")
                            }
                            bmgObj.items.push(bmgItem);
                            saveObj.push(bmgObj);
                        }

                    });
                }

                //遍历音频组件结束


                //遍历广告组件
                var adObj = {
                    title: "",
                    type: "ad",
                    items: [],
                    sys_order: 0
                };

                var adItem = {
                    unitid: ""
                }

                if ($("#txtBody .ADItem").length > 0) {
                    $("#txtBody .ADItem").each(function () {
                        var obj = $(this);
                        if(obj.data("unitid")!=''&&obj.data("unitid")!=undefined){
                            adObj = {
                                title: "",
                                type: "ad",
                                items: [],
                                sys_order: parseInt(obj.attr("data-dad-position"))
                            };
                            adItem = {
                                unitid: obj.data("unitid")
                            }
                            adObj.items.push(adItem);
                            saveObj.push(adObj);
                        }

                    });
                }




                //遍历关注公众号组件
                var adObj = {
                    title: "",
                    type: "oa",
                    items: [],
                    sys_order: 0
                };

                var oaItem = {
                    open: 0
                }

                if ($("#txtBody .OfficialAccountItem").length > 0) {
                    $("#txtBody .OfficialAccountItem").each(function () {
                        var obj = $(this);
                        var a =parseInt($("input[name='OfficialAccountOpen']:checked").val())||0;
                        adObj = {
                            title: "",
                            type: "oa",
                            items: [],
                            sys_order: parseInt(obj.attr("data-dad-position"))
                        };
                        oaItem = {
                            open: a
                        }
                        adObj.items.push(oaItem);
                        saveObj.push(adObj);

                    });
                }




                if(!isSubmit){
                    return;
                }
                saveObj = saveObj.sort(sortorder);

                var paramsData = { Id:@pageIndexModel.Id, RelationId:@ViewBag.Id,pageTitle:pageTitle, JsonMsg: JSON.stringify(saveObj) }
                $('#loading').modal('show');
                $.ajax({
                    type: "POST",
                    url: "/pageindex/SetPageIndex",
                    data: paramsData,
                    success: function (data) {

                        if (data && data.isok) {
                            $("#modelMsg").html("操作成功2秒后自动刷新页面!");

                            window.setTimeout(function(){
                                $('#loading').modal('hide');
                                window.location.reload();
                            },2000);

                        } else {
                            layer.msg("操作失败");

                        }
                    },
                    error: function () {
                        layer.msg("通讯异常");

                    }
                });



            });



        });

        //组件排序
        function sortorder(a, b) {
            return a.sys_order - b.sys_order
        }










        function ChooseLocationOK(){
            var _location = mapframe.window.document.getElementById("poi_cur").value;
            var _addr = mapframe.window.document.getElementById("addr_cur").value;
            var _zoom = mapframe.window.document.getElementById("zoomlevel").innerHTML;
            _zoom=parseInt(_zoom) || 15;
            if (_location == "") {
                layer.msg("您还未选择地理位置!");
                return;
            }
            console.log(_location);
            console.log(_addr);
            console.log(_zoom);


            $(curEditItem).data("locationpoint", _location);
            $(curEditItem).data("addr", _addr);
            $(curEditItem).data("zoom", _zoom);
            $("#MapMsg .actionbtn").html("+"+_addr);
            $("#ChooseLocationModal").modal("hide");
        }


    </script>

    <script>
        var mask;
        var MAX_IMG_SIZE=1,MAX_AUDIO_SIZE=10,MAX_VIDEO_SIZE=20;
        var uploader= {
            tempFilePath: null,
            img: {
                instalce: null,
                filePath: '',
                element: null
            },
            video: {
                instalce: null,
                filePath: '',
                element: null
            },
            audio: {
                instalce: null,
                filePath: '',
                element: null
            }
        }
        /********初始化上传组件*********/
        function initUploader (type) {

            var options = {
                browse_button: 'browse_file_' + type,
                url: 'http://oss.aliyuncs.com',
                flash_swf_url: '@(WebSiteConfig.cdnurl)content/aliosslib/lib/lib/plupload-2.1.2/js/Moxie.swf',
                silverlight_xap_url: '@(WebSiteConfig.cdnurl)content/aliosslib/lib/lib/plupload-2.1.2/js/Moxie.xap',
                filters: {

                },
                multi_selection: false

            };
            switch (type) {
                case 'img':

                    options.filters = {

                        mime_types: [
                            {
                                title: "图片文件",
                                extensions: "jpg,jpeg,gif,png"
                            },
                        ],
                        //max_file_size: '5mb'
                    }
                    break;
                case 'video':
                    options.filters = {

                        mime_types: [ //只允许上传图片和zip文件
                            {
                                title: "视频文件",
                                extensions: "mp4,m3u8",
                            },
                        ],
                        //max_file_size: '20mb'
                    }

                    break;
                case 'audio':
                    options.filters = {

                        mime_types: [ //只允许上传图片和zip文件
                            {
                                title: "音频文件",
                                extensions: "mp3",
                            },
                        ],
                        //max_file_size: '10mb'
                    }


                    break;
            }
            //如果还有当前类型的上传组件实例的话则先把其销毁
            if (uploader[type].instance) {
                console.log('destroy uploader :' + type);
                uploader[type].instance.destroy();
            }
            uploader[type].instance = new plupload.Uploader(options);

            uploader[type].instance.init();

            uploader[type].instance.bind('BeforeUpload', function (d, f) {


                //取到文件后缀名

                var fileName = f.name;
                var ext = fileName.substring(fileName.lastIndexOf('.') + 1, fileName.length);

                //转成Mb
                var fileSize = f.size / 1024 / 1024;
                var flag = true;

                switch (type) {
                    case 'img':
                        if (!['jpg', 'png', 'gif', 'jpeg'].contains(ext)) {
                            layer.msg('请上传正确的图片格式，后缀名可为：jpg,png,gif,jpeg');
                            flag = false;
                        }
                        if (fileSize > MAX_IMG_SIZE) {
                            layer.msg('文件最大支持 ' + MAX_IMG_DSIZE + 'Mb');
                            flag = false;

                        }
                        break;
                    case 'audio':
                        if (!['mp3'].contains(ext)) {
                            layer.msg('请上传正确的音频格式文件，后缀名可为：mp3');
                            flag = false;

                        }
                        if (fileSize > MAX_AUDIO_SIZE) {
                            layer.msg('文件最大支持 ' + MAX_AUDIO_SIZE + 'Mb');
                            flag = false;

                        }
                        break;
                    case 'video':
                        if (!['mp4', 'm3u8'].contains(ext)) {
                            layer.msg('请上传正确的视频格式文件，后缀名可为：mp4,m3u8');
                            flag = false;

                        }
                        if (fileSize > MAX_VIDEO_SIZE) {
                            layer.msg('文件最大支持 ' + MAX_VIDEO_SIZE + 'Mb');
                            flag = false;
                        }
                        break;
                }
                //如果在上传中遇到文件类型和文件大小不正确的错误时重新初始上传组件
                if (!flag) {
                    initUploader(type);
                }

                uploader.token.key += '.' + ext;
                uploader[type].instance.setOption(uploader.token);

            });

            uploader[type].instance.bind('FilesAdded', function (uploader, files) {
                $('#start_upload_' + type).click();
            });
            uploader[type].instance.bind('UploadProgress', function (uploader, file) {

                mask=  layer.load(0, {content: file.percent + "%",shade: [0.8, '#393D49'],

                    success: function(layero){
                        layero.find('.layui-layer-content').css('color', 'white').css('font-size','2rem').css('background','none');
                    }
                });
            });
            uploader[type].instance.bind('UploadComplete', function (d, f, e) {


                layer.close(mask);
                var fileName = f[0].name;
                var fileExt = fileName.substring(fileName.lastIndexOf('.') + 1, fileName.length);
                var filePath = uploader[type].filePath + '.' + fileExt;
                if(curEditItem.hasClass("ImgItem")){
                    //表示单张图上传
                    $(curEditItem).data("img",filePath);
                    $(thisUploadSigImg).attr("src",filePath);
                    $(thisUploadSigImg).next().css("display", "block");
                }


                if(curEditItem.hasClass("bannerItem")){
                    //表示轮播图
                    var curImgIndex = $("#bannerMsg").find(".defaultUploadAttr").index(thisUploadImg);
                    var curbannerImg = curEditItem.find(".bannerImg")[curImgIndex];
                    $(curbannerImg).data("img", filePath);
                    var Poster = '<img src="' + filePath + '"  title="删除此张重新上传" style="display:block"/><span class="DelPoster" style="position: absolute;right:0px;top: 0px;"><i style="font-size: x-large;cursor: pointer;" class="Hui-iconfont">&#xe706;</i></span>';
                    thisUploadImg.parent().append(Poster);//--图片url
                    $(thisUploadImg).css("display","none");
                }

                if(curEditItem.hasClass("BmgItem")){
                    //上传音频
                    $(curEditItem).data("bmg", filePath);
                    $(thisUploadBmg).attr("src","@(WebSiteConfig.cdnurl)content/Miniapp/imgs/bmg.png");
                    $(thisUploadBmg).next().css("display", "block");

                }

                if(curEditItem.hasClass("videoItem")){
                    //上传视频
                    if(['jpg', 'png', 'gif', 'jpeg'].contains(fileExt)){
                        //表示上传的是视频封面
                        $(curEditItem).data("img",filePath);
                        $(thisUploadSigImg).attr("src",filePath);
                        $(thisUploadSigImg).next().css("display", "block");
                    }else{
                        $(curEditItem).data("video", filePath);
                        $(thisUploadVideo).attr("src","@(WebSiteConfig.cdnurl)content/Miniapp/imgs/viedeo.png");
                        $(thisUploadVideo).next().css("display", "block");
                    }



                }



                //上传完成后重新初始上传组件
                initUploader(type);

            });

        }

        function uploadFile (type) {
            //   var that = this;
            $.get('/upload/initupload', {
                type: type
            }).then(function (data) {
                var filePath = data.dir + data.key;
                uploader[type].filePath = data.host + '/' + filePath;

                var multipartParams = {
                    //因为不知道生成随机文件名的规则，所以，存储原始文件名
                    'key': filePath,
                    'policy': data.policy,
                    'OSSAccessKeyId': data.accessid,
                    'success_action_status': '200',
                    'signature': data.signature
                };
                uploader.token = multipartParams;
                uploader[type].instance.setOption({
                    'url': data.host,
                    'multipart_params': multipartParams
                });
                uploader[type].instance.start();
            }).fail(function (data) {
            });

        }

        //初始化上传组件
        initUploader('img');
        initUploader('video');
        initUploader('audio');

    </script>

}
